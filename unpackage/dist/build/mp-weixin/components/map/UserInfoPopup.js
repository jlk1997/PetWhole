"use strict";const e=require("../../common/vendor.js"),t=require("../../common/assets.js"),s={name:"UserInfoPopup",props:{user:{type:Object,default:()=>({})},pets:{type:Array,default:()=>[]},isFollowing:{type:Boolean,default:!1},visible:{type:Boolean,default:!1}},data:()=>({selectedPet:null,combinedPets:[],userIsFollowed:!1}),computed:{effectivePets(){var e;return console.log("计算有效宠物列表:",{userPets:(null==(e=this.user)?void 0:e.pets)||[],propsPets:this.pets||[]}),this.user&&this.user.pets&&this.user.pets.length>0?this.user.pets:this.pets||[]},shouldShowNoPets(){const e=this.effectivePets.length>0;return console.log("是否应该显示没有宠物提示:",!e),!e},isCurrentUser(){return this.user&&!0===this.user.isCurrentUser}},watch:{user:{handler(e){console.log("用户数据变化:",e),this.updateSelectedPet(),e&&this.syncFollowStatus()},immediate:!0,deep:!0},pets:{handler(e){console.log("传入的宠物列表变化:",e),this.updateSelectedPet()},immediate:!0},effectivePets:{handler(e){console.log("有效宠物列表变化:",e),e&&e.length>0&&!this.selectedPet&&(this.selectedPet=e[0])}},visible(e){e&&(console.log("弹窗显示，检查宠物选择状态和关注状态"),this.updateSelectedPet(),this.syncFollowStatus())},isFollowing:{handler(e){console.log("props中的关注状态变化:",e),this.userIsFollowed=e},immediate:!0}},mounted(){console.log("UserInfoPopup mounted:",{user:this.user,pets:this.pets,visible:this.visible,isFollowing:this.isFollowing}),this.syncFollowStatus()},methods:{syncFollowStatus(){return console.log("同步关注状态"),void 0!==this.isFollowing?(console.log("使用props中传入的关注状态:",this.isFollowing),void(this.userIsFollowed=this.isFollowing)):this.user&&void 0!==this.user.isFollowing?(console.log("从用户对象中获取关注状态:",this.user.isFollowing),void(this.userIsFollowed=this.user.isFollowing)):(console.log("没有找到关注状态信息，默认为未关注"),void(this.userIsFollowed=!1))},updateSelectedPet(){const e=this.effectivePets;console.log("更新选中宠物, 宠物列表:",e),e&&e.length>0?(this.selectedPet=this.user&&this.user.currentPet||e[0],console.log("设置选中宠物:",this.selectedPet)):(console.log("没有找到宠物数据"),this.selectedPet=null)},handleClose(){this.$emit("close")},handleFollow(){this.userIsFollowed=!this.userIsFollowed,this.$emit("follow",this.user)},handleMessage(){this.$emit("message",this.user)},selectPet(e){this.selectedPet=e},isActivePet(e){return this.selectedPet&&e&&this.selectedPet.name===e.name},formatPetGender(e){if(!e)return"未知";return{male:"公",female:"母",unknown:"未知"}[e]||e},formatPetAge(e){if("number"==typeof e)return`${e}岁`;if("string"==typeof e&&(e.includes("岁")||/^\d+$/.test(e)))return/^\d+$/.test(e)?`${e}岁`:e;if(this.selectedPet&&void 0!==this.selectedPet.age){if("number"==typeof this.selectedPet.age)return`${this.selectedPet.age}岁`;if("string"==typeof this.selectedPet.age)return this.selectedPet.age.includes("岁")?this.selectedPet.age:`${this.selectedPet.age}岁`}if(!e)return"未知年龄";try{const t=new Date(e),s=new Date;if(isNaN(t.getTime()))return"未知年龄";const l=12*(s.getFullYear()-t.getFullYear())+(s.getMonth()-t.getMonth());if(l<12)return`${l}个月`;{const e=Math.floor(l/12),t=l%12;return t>0?`${e}岁${t}个月`:`${e}岁`}}catch(t){return console.error("格式化宠物年龄出错:",t),"未知年龄"}},navigateToAddPet(){e.index.switchTab({url:"/pages/index/index"}),this.handleClose()},handleImageError(e){console.warn("图片加载失败:",e.target),e.target.src="/static/images/default-avatar.png"},formatImageUrl(t){if(!t)return"/static/images/default-avatar.png";if(t.startsWith("http://")||t.startsWith("https://")||t.startsWith("/static/"))return t;if(t.startsWith("/uploads")){return(e.index.getStorageSync("BASE_URL")||"http://49.235.65.37:5000")+t}if(t.startsWith("uploads/")){return(e.index.getStorageSync("BASE_URL")||"http://49.235.65.37:5000")+"/"+t}return"/static/images/default-avatar.png"},formatSocialIntention:e=>({strong:"强烈",medium:"较强",mild:"平淡"}[e]||"未知"),formatMatingStatus:e=>({single:"单身待求偶",paired:"有配偶",notLooking:"暂不找配偶"}[e]||"未知"),previewPhoto(t){const s=this.formatImageUrl(t);e.index.previewImage({urls:[s],current:s})}}};const l=e._export_sfc(s,[["render",function(s,l,o,i,r,n){var a,d,u,c,h,g,P,m,v,f,p,w,I,S,F,y,U,b,C,$,k,A,x,M,W,E,N,T,_,B,j;return e.e({a:e.o(((...e)=>n.handleClose&&n.handleClose(...e))),b:n.formatImageUrl(null==(a=o.user)?void 0:a.avatar),c:e.o(((...e)=>n.handleImageError&&n.handleImageError(...e))),d:e.t((null==(d=o.user)?void 0:d.nickname)||(null==(u=o.user)?void 0:u.username)||"用户"),e:o.user&&o.user.isWalking},(o.user&&o.user.isWalking,{}),{f:o.user&&o.user.currentPet},o.user&&o.user.currentPet?{g:n.formatImageUrl(null==(c=o.user.currentPet)?void 0:c.avatar),h:e.o(((...e)=>n.handleImageError&&n.handleImageError(...e))),i:e.t((null==(h=o.user.currentPet)?void 0:h.name)||"宠物"),j:e.t((null==(g=o.user.currentPet)?void 0:g.breed)||"未知品种"),k:e.t(n.formatPetAge(null==(P=o.user.currentPet)?void 0:P.birthdate))}:{},{l:n.effectivePets.length>0},n.effectivePets.length>0?e.e({m:e.t(n.isCurrentUser?"我的宠物":"所有宠物"),n:e.f(n.effectivePets,((t,s,l)=>({a:n.formatImageUrl(null==t?void 0:t.avatar),b:e.t((null==t?void 0:t.name)||"宠物"),c:s,d:n.isActivePet(t)?1:"",e:e.o((e=>n.selectPet(t)),s)}))),o:r.selectedPet},r.selectedPet?e.e({p:n.formatImageUrl(null==(m=r.selectedPet)?void 0:m.avatar),q:e.t((null==(v=r.selectedPet)?void 0:v.name)||"宠物"),r:e.t((null==(f=r.selectedPet)?void 0:f.breed)||"未知品种"),s:e.t(n.formatPetAge(null==(p=r.selectedPet)?void 0:p.birthdate)||"未知"),t:null==(w=r.selectedPet)?void 0:w.weight},(null==(I=r.selectedPet)?void 0:I.weight)?{v:e.t(null==(S=r.selectedPet)?void 0:S.weight)}:{},{w:null==(F=r.selectedPet)?void 0:F.gender},(null==(y=r.selectedPet)?void 0:y.gender)?{x:e.t(n.formatPetGender(null==(U=r.selectedPet)?void 0:U.gender))}:{},{y:null==(b=r.selectedPet)?void 0:b.socialIntention},(null==(C=r.selectedPet)?void 0:C.socialIntention)?{z:e.t(n.formatSocialIntention(null==($=r.selectedPet)?void 0:$.socialIntention))}:{},{A:null==(k=r.selectedPet)?void 0:k.matingStatus},(null==(A=r.selectedPet)?void 0:A.matingStatus)?{B:e.t(n.formatMatingStatus(null==(x=r.selectedPet)?void 0:x.matingStatus))}:{},{C:(null==(M=r.selectedPet)?void 0:M.dailyPhotos)&&r.selectedPet.dailyPhotos.length>0},(null==(W=r.selectedPet)?void 0:W.dailyPhotos)&&r.selectedPet.dailyPhotos.length>0?{D:e.f(r.selectedPet.dailyPhotos,((t,s,l)=>({a:n.formatImageUrl(t.url),b:s,c:e.o((e=>n.previewPhoto(t.url)),s)})))}:{},{E:null==(E=r.selectedPet)?void 0:E.description},(null==(N=r.selectedPet)?void 0:N.description)?{F:e.t(null==(T=r.selectedPet)?void 0:T.description)}:{}):{}):n.shouldShowNoPets?e.e({H:t._imports_0$8,I:e.t(n.isCurrentUser?"您还没有添加宠物信息":"该用户还没有添加宠物信息"),J:n.isCurrentUser},n.isCurrentUser?{K:e.o(((...e)=>n.navigateToAddPet&&n.navigateToAddPet(...e)))}:{}):{},{G:n.shouldShowNoPets,L:o.user&&o.user.isWalking&&o.user.walkStats},o.user&&o.user.isWalking&&o.user.walkStats?{M:e.t((null==(_=o.user.walkStats)?void 0:_.distance)||0),N:e.t((null==(B=o.user.walkStats)?void 0:B.duration)||"00:00"),O:e.t((null==(j=o.user.walkStats)?void 0:j.speed)||0)}:{},{P:!n.isCurrentUser},n.isCurrentUser?{}:{Q:e.t(r.userIsFollowed?"已关注":"关注"),R:r.userIsFollowed?1:"",S:e.o(((...e)=>n.handleFollow&&n.handleFollow(...e))),T:e.o(((...e)=>n.handleMessage&&n.handleMessage(...e)))},{U:o.visible?1:""})}]]);wx.createComponent(l);
