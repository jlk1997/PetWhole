"use strict";var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,n=(t,a,o)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[a]=o,i=(e,t)=>{for(var a in t||(t={}))l.call(t,a)&&n(e,a,t[a]);if(o)for(var a of o(t))s.call(t,a)&&n(e,a,t[a]);return e},r=(e,o)=>t(e,a(o)),c=(e,t,a)=>new Promise(((o,l)=>{var s=e=>{try{i(a.next(e))}catch(t){l(t)}},n=e=>{try{i(a.throw(e))}catch(t){l(t)}},i=e=>e.done?o(e.value):Promise.resolve(e.value).then(s,n);i((a=a.apply(e,t)).next())}));const u=require("../../common/vendor.js"),g=require("../../store/user.js"),d=require("../../store/location.js"),v=require("../../utils/amap.js"),y=require("../../utils/api.js"),h=require("../../utils/chatService.js"),m=require("../../utils/networkManager.js"),f=require("../../utils/chatStorage.js");require("../../config/index.js");const p=require("../../common/assets.js"),T={setup(){const e=g.useUserStore(),t=d.useLocationStore(),a=u.computed((()=>e.user||{})),o=u.computed((()=>a.value.id||a.value._id||"")),l=u.ref("nearby"),s=u.ref({isConnected:!0,networkType:"unknown"}),n=u.reactive({latitude:null,longitude:null,address:"",city:"",district:"",lastUpdated:null}),p=u.ref([]),T=u.ref([]),M=u.ref(0),w=u.ref(0),b=u.ref(!1),S=u.ref(!1),D=u.ref(!1),x=u.ref(!1),B=u.ref(""),C=u.ref(!1),L=u.ref(!0),k=u.ref(1),N=u.ref(1);let A=null;const I=u.ref(!0),j=u.ref({atBottom:!0}),U=u.ref({atBottom:!0}),H=()=>c(this,null,(function*(){try{console.log("开始初始化位置信息");const e=t.location;e&&e.latitude&&e.longitude&&(console.log("从store获取到位置信息:",e),n.latitude=e.latitude,n.longitude=e.longitude,n.address=e.address||"",n.city=e.city||"",n.district=e.district||"",n.lastUpdated=e.lastUpdated||Date.now(),console.log("成功设置位置信息到currentLocation:",n));const a=6e5;!n.latitude||!n.longitude||!n.lastUpdated||Date.now()-n.lastUpdated>a?(console.log("位置信息不存在或已过期，重新获取"),yield O()):(console.log("使用现有位置信息加载消息"),yield P(),Y(),setTimeout((()=>{Y()}),500))}catch(e){console.error("初始化位置信息失败:",e),u.index.showToast({title:"获取位置信息失败，请检查定位权限",icon:"none"})}})),O=()=>c(this,null,(function*(){try{u.index.showLoading({title:"获取位置中...",mask:!1}),console.log("开始获取位置");const e=yield v.getCurrentLocation();console.log("获取到位置:",e),e&&e.latitude&&e.longitude?(n.latitude=e.latitude,n.longitude=e.longitude,n.address=e.address||"",n.city=e.city||"",n.district=e.district||"",n.lastUpdated=Date.now(),t.updateLocation({latitude:e.latitude,longitude:e.longitude,address:e.address,city:e.city,district:e.district,lastUpdated:Date.now(),timestamp:(new Date).toISOString()}),console.log("位置获取成功，刷新消息，当前位置:",n),u.index.hideLoading(),yield u.nextTick$1(),P()):(console.error("获取到的位置数据不完整:",e),u.index.hideLoading(),u.index.showToast({title:"获取位置信息不完整，请检查定位权限",icon:"none",duration:2e3}))}catch(e){console.error("刷新位置信息失败:",e),u.index.hideLoading(),u.index.showToast({title:"获取位置信息失败，请检查定位权限",icon:"none"})}})),P=()=>c(this,null,(function*(){if(console.log("refreshMessages被调用，当前标签:",l.value),console.log("当前位置信息:",n),!n.latitude||!n.longitude)return console.warn("刷新消息失败：位置信息不存在"),void u.index.showToast({title:"无法获取位置信息，请点击刷新按钮",icon:"none"});try{u.index.showLoading({title:"加载中...",mask:!1}),"nearby"===l.value?(console.log("开始刷新附近消息"),yield q(!0)):(console.log("开始刷新城市消息"),yield $(!0)),u.index.hideLoading(),console.log("消息刷新完成"),setTimeout((()=>{"nearby"===l.value?M.value=999999:w.value=999999}),100),setTimeout((()=>{"nearby"===l.value?M.value=999999:w.value=999999}),300)}catch(e){u.index.hideLoading(),console.error("刷新消息时发生错误:",e),u.index.showToast({title:"加载消息失败，请稍后再试",icon:"none"})}})),q=(e=!1)=>c(this,null,(function*(){if(!n.latitude||!n.longitude){console.log("位置信息不存在，尝试从store获取");const e=t.location;if(!(e&&e.latitude&&e.longitude))return console.log("无法获取位置信息，显示提示"),void u.index.showToast({title:"无法获取位置信息，请检查定位权限",icon:"none"});n.latitude=e.latitude,n.longitude=e.longitude,n.address=e.address||"",n.city=e.city||"",n.district=e.district||"",n.lastUpdated=e.lastUpdated||Date.now(),console.log("成功从store获取位置信息:",n)}if(!S.value||e)try{S.value=!0,e&&(k.value=1,D.value=!1);const t={latitude:n.latitude,longitude:n.longitude,radius:5e3,page:1,limit:30,sort:"desc"};e||(t.page=k.value),console.log("加载附近消息, 参数:",t);const a=yield y.api.chat.getNearbyMessages(t);console.log("API直接返回的附近消息:",a);let o=[];if(a&&a.data?o=a.data:Array.isArray(a)&&(o=a),o.sort(((e,t)=>new Date(e.createTime)-new Date(t.createTime))),console.log("处理后的消息数据:",o),o&&o.length>0)e?(p.value=[...o],console.log("刷新消息列表，当前消息数:",p.value.length),yield u.nextTick$1(),E(!0)):(p.value=[...o,...p.value],console.log("追加历史消息，当前消息数:",p.value.length)),f.chatStorage.saveNearbyMessagesCache(p.value),k.value++;else if(e||(D.value=!0,console.log("没有更多消息")),e&&(!o||0===o.length)){const e=f.chatStorage.getNearbyMessagesCache();e&&e.length>0&&(console.log("从缓存加载附近消息"),e.sort(((e,t)=>new Date(e.createTime)-new Date(t.createTime))),p.value=e)}}catch(a){if(console.error("加载附近消息失败:",a),m.networkManager.isNetworkError&&m.networkManager.isNetworkError(a)){const t=f.chatStorage.getNearbyMessagesCache();t&&t.length>0&&(console.log("网络错误，从缓存加载附近消息"),(e||0===p.value.length)&&(p.value=t))}u.index.showToast({title:"加载消息失败，请检查网络连接",icon:"none"})}finally{S.value=!1}else console.log("已有加载请求进行中，跳过")})),$=(e=!1)=>c(this,null,(function*(){if(!n.city){if(console.log("城市信息不存在，尝试从地址中提取"),n.address){const e=n.address.split("市");if(e.length>0){const t=e[0].match(/([^省]+?)市/);if(t&&t[1])n.city=t[1],console.log("从地址中提取的城市:",n.city);else{const e=n.address.split(/[省市区县]/);e.length>1&&(n.city=e[1].trim(),console.log("从地址分割中提取的城市:",n.city))}}}if(!n.city&&n.latitude&&n.longitude){console.log("从经纬度反查城市信息");try{const e=yield v.getCurrentLocation();e&&e.city?(n.city=e.city,console.log("从getCurrentLocation获取到城市:",n.city)):(n.city="上海市",console.log("无法获取城市信息，使用默认城市"))}catch(a){console.error("反查城市出错:",a),n.city="上海市"}}n.city||(console.log("无法获取城市信息，使用默认城市"),n.city="上海市"),n.latitude&&n.longitude?t.updateLocation(r(i({},t.location),{city:n.city,latitude:n.latitude,longitude:n.longitude,timestamp:(new Date).toISOString()})):console.log("无法更新位置store：缺少经纬度信息")}if(!S.value||e)try{S.value=!0,e&&(N.value=1,x.value=!1);const t={cityName:n.city,page:1,limit:30,sort:"desc"};e||(t.page=N.value),console.log("加载城市消息, 参数:",t);const a=yield y.api.chat.getCityMessages(t);console.log("API直接返回的城市消息:",a);let o=[];if(a&&a.data?o=a.data:Array.isArray(a)&&(o=a),o.sort(((e,t)=>new Date(e.createTime)-new Date(t.createTime))),console.log("处理后的城市消息数据:",o),o&&o.length>0)e?(T.value=[...o],console.log("刷新城市消息列表，当前消息数:",T.value.length),yield u.nextTick$1(),E(!0)):(T.value=[...o,...T.value],console.log("追加历史城市消息，当前消息数:",T.value.length)),f.chatStorage.saveCityMessagesCache(T.value,n.city),N.value++;else if(e||(x.value=!0,console.log("没有更多城市消息")),e&&(!o||0===o.length)){const e=f.chatStorage.getCityMessagesCache(n.city);e&&e.length>0&&(console.log("从缓存加载城市消息"),T.value=e)}}catch(a){if(console.error("加载城市消息失败:",a),m.networkManager.isNetworkError&&m.networkManager.isNetworkError(a)){const t=f.chatStorage.getCityMessagesCache(n.city);t&&t.length>0&&(console.log("网络错误，从缓存加载城市消息"),(e||0===T.value.length)&&(T.value=t))}u.index.showToast({title:"加载消息失败，请检查网络连接",icon:"none"})}finally{S.value=!1}else console.log("已有加载请求进行中，跳过")})),E=(e=!1)=>{console.log("执行滚动到底部, 强制滚动:",e),setTimeout((()=>{try{"nearby"===l.value?M.value=999999:w.value=999999,"nearby"===l.value?j.value.atBottom=!0:U.value.atBottom=!0,console.log("设置scrollTop以滚动到底部")}catch(e){console.error("滚动到底部出错:",e)}}),50)},_=()=>{A&&(clearInterval(A),A=null),A=setInterval((()=>{if(L.value&&s.value.isConnected){console.log("自动刷新消息");("nearby"===l.value?j.value.atBottom:U.value.atBottom)?F():console.log("用户正在查看历史消息，跳过自动刷新")}}),6e4)},F=()=>c(this,null,(function*(){if(console.log("静默刷新消息"),n.latitude&&n.longitude)try{const e="nearby"===l.value?p.value.length:T.value.length;"nearby"===l.value?yield R():yield W();if(("nearby"===l.value?p.value.length:T.value.length)>e){("nearby"===l.value?j.value.atBottom:U.value.atBottom)?(console.log("检测到新消息且用户在底部，滚动到最新消息"),yield u.nextTick$1(),E(!0)):console.log("有新消息但用户不在底部，不自动滚动")}}catch(e){console.error("静默刷新消息失败:",e)}else console.warn("刷新消息失败：位置信息不存在")})),R=()=>c(this,null,(function*(){try{const e={latitude:n.latitude,longitude:n.longitude,radius:5e3,page:1,limit:30,sort:"desc"};console.log("静默加载附近消息, 参数:",e);const t=yield y.api.chat.getNearbyMessages(e);let a=[];if(t&&t.data?a=t.data:Array.isArray(t)&&(a=t),a.sort(((e,t)=>new Date(e.createTime)-new Date(t.createTime))),a&&a.length>0){const e=p.value.map((e=>e.id)),t=a.filter((t=>!e.includes(t.id)));if(t.length>0)return p.value=[...p.value,...t],p.value.length>50&&(p.value=p.value.slice(-50)),f.chatStorage.saveNearbyMessagesCache(p.value),!0}return!1}catch(e){return console.error("静默加载附近消息失败:",e),!1}})),W=()=>c(this,null,(function*(){try{const e={cityName:n.city,page:1,limit:30,sort:"desc"};console.log("静默加载城市消息, 参数:",e);const t=yield y.api.chat.getCityMessages(e);let a=[];if(t&&t.data?a=t.data:Array.isArray(t)&&(a=t),a.sort(((e,t)=>new Date(e.createTime)-new Date(t.createTime))),a&&a.length>0){const e=T.value.map((e=>e.id)),t=a.filter((t=>!e.includes(t.id)));if(t.length>0)return T.value=[...T.value,...t],T.value.length>50&&(T.value=T.value.slice(-50)),f.chatStorage.saveCityMessagesCache(T.value,n.city),!0}return!1}catch(e){return console.error("静默加载城市消息失败:",e),!1}}));u.watch(l,(e=>{console.log("标签切换到:",e),"nearby"===e?0===p.value.length?q(!0):setTimeout((()=>{E(!0)}),100):"city"===e&&(0===T.value.length?$(!0):setTimeout((()=>{E(!0)}),100))}));const Y=()=>{console.log("强制执行滚动到底部"),setTimeout((()=>{try{"nearby"===l.value?(M.value=99999999,console.log("强制设置附近消息scrollTop:",M.value),j.value.atBottom=!0):(w.value=99999999,console.log("强制设置城市消息scrollTop:",w.value),U.value.atBottom=!0)}catch(e){console.error("forceScrollToBottom出错:",e),"nearby"===l.value?M.value=99999999:w.value=99999999}}),50)};return u.onLoad((()=>c(this,null,(function*(){console.log("聊天页面加载"),m.networkManager.addListener((e=>{s.value=e,console.log("网络状态更新:",e),e.isConnected&&L.value&&(console.log("网络恢复，刷新消息"),P())})),u.index.$on("network:reconnected",(()=>{L.value&&(console.log("网络恢复事件，刷新消息"),P())})),u.index.$on("chat:message-status-update",(({messageId:e,status:t,serverData:a})=>{console.log("收到消息状态更新:",e,t);const o=o=>{const l=o.findIndex((t=>t.id===e));return-1!==l&&(o[l].status=t,a&&(o[l].id=a.id||a._id||o[l].id,o[l].serverTime=a.createdAt||a.createTime),!0)},l=o(p.value),s=o(T.value);(l||s)&&console.log("已更新消息状态")})),f.chatStorage.clearExpiredMessageCaches(),(()=>{const e=f.chatStorage.getPendingMessages();e&&e.length>0&&(console.log("恢复待处理消息:",e.length),e.forEach((e=>{"nearby"===e.type?(-1===p.value.findIndex((t=>t.id===e.id))&&p.value.push({id:e.id,content:e.content,userId:e.userId,userName:e.userName,userAvatar:e.userAvatar,createTime:e.createTime,status:e.status,distance:0,isOwnMessage:!0}),"sending"!==e.status&&"failed"!==e.status||h.chatService.sendNearbyMessage(e.data)):"city"===e.type&&(-1===T.value.findIndex((t=>t.id===e.id))&&T.value.push({id:e.id,content:e.content,userId:e.userId,userName:e.userName,userAvatar:e.userAvatar,createTime:e.createTime,status:e.status,isOwnMessage:!0}),"sending"!==e.status&&"failed"!==e.status||h.chatService.sendCityMessage(e.data))})))})(),_(),console.log("开始初始化位置和加载消息");try{yield H(),console.log("初始化位置和加载消息完成"),setTimeout((()=>{"nearby"===l.value?M.value=999999:w.value=999999}),300),setTimeout((()=>{"nearby"===l.value?M.value=999999:w.value=999999}),800)}catch(e){console.error("初始化位置和加载消息失败:",e),P(),setTimeout((()=>{Y()}),800)}})))),u.onShow((()=>{L.value=!0,H(),s.value.isConnected&&P(),_(),setTimeout((()=>{"nearby"===l.value?(M.value=999999,j.value.atBottom=!0):(w.value=999999,U.value.atBottom=!0)}),300),setTimeout((()=>{"nearby"===l.value?M.value=999999:w.value=999999}),600)})),u.onHide((()=>{L.value=!1,A&&(clearInterval(A),A=null)})),u.onUnload((()=>{A&&(clearInterval(A),A=null),u.index.$off("chat:message-status-update"),u.index.$off("network:reconnected")})),{activeTab:l,currentLocation:n,networkStatus:s,nearbyMessages:p,cityMessages:T,scrollTop:M,cityScrollTop:w,showBackToBottom:b,isLoading:S,noMoreNearbyMessages:D,noMoreCityMessages:x,newMessage:B,inputFocus:C,userInfo:a,userId:o,refreshLocation:O,loadMoreNearbyMessages:()=>{if(D.value||S.value)return;const e=p.value.length;q().then((()=>{const t=p.value.length-e;t>0&&setTimeout((()=>{u.index.createSelectorQuery().selectAll(".message-item").boundingClientRect((e=>{if(e&&e.length>0){let a=0;for(let o=0;o<Math.min(t,e.length);o++)a+=e[o].height;"nearby"===l.value&&(M.value+=a)}})).exec()}),100)}))},loadMoreCityMessages:()=>{if(x.value||S.value)return;const e=T.value.length;$().then((()=>{const t=T.value.length-e;t>0&&setTimeout((()=>{u.index.createSelectorQuery().selectAll(".message-item").boundingClientRect((e=>{if(e&&e.length>0){let a=0;for(let o=0;o<Math.min(t,e.length);o++)a+=e[o].height;"city"===l.value&&(w.value+=a)}})).exec()}),100)}))},sendMessage:()=>c(this,null,(function*(){if(!B.value.trim())return;if(!s.value.isConnected)return void u.index.showToast({title:"网络不可用，请检查网络连接",icon:"none"});if(!n.latitude||!n.longitude)return void u.index.showToast({title:"位置信息不存在，无法发送消息",icon:"none"});const e=B.value.trim();B.value="";const t={id:"temp-"+Date.now(),content:e,userId:o.value,userName:a.value.nickname||a.value.username||"游客",userAvatar:a.value.avatar||"/static/images/default-avatar.png",createTime:(new Date).getTime(),status:"sending",isOwnMessage:!0};if("nearby"===l.value){t.distance=0,p.value.push(t),f.chatStorage.savePendingMessage(r(i({},t),{type:"nearby",data:{content:e,latitude:n.latitude,longitude:n.longitude}}));try{yield h.chatService.sendNearbyMessage({content:e,latitude:n.latitude,longitude:n.longitude})}catch(c){console.error("发送附近消息失败:",c)}}else{T.value.push(t),f.chatStorage.savePendingMessage(r(i({},t),{type:"city",data:{content:e,cityName:n.city,latitude:n.latitude,longitude:n.longitude}}));try{yield h.chatService.sendCityMessage({content:e,cityName:n.city,latitude:n.latitude,longitude:n.longitude})}catch(c){console.error("发送城市消息失败:",c)}}console.log("发送消息后，强制滚动到底部显示新消息"),yield u.nextTick$1(),"nearby"===l.value?(M.value=0,setTimeout((()=>{M.value=999999,j.value.atBottom=!0}),10)):(w.value=0,setTimeout((()=>{w.value=999999,U.value.atBottom=!0}),10)),setTimeout((()=>{"nearby"===l.value?M.value=999999:w.value=999999,console.log("发送消息后，设置scrollTop完成")}),150)})),shouldShowDate:(e,t,a)=>{if(0===t)return!0;const o=a[t-1],l=new Date(o.createTime),s=new Date(e.createTime);return s-l>18e5||l.toDateString()!==s.toDateString()},formatDate:e=>{if(!e)return"";const t=new Date(e),a=new Date;if(t.toDateString()===a.toDateString())return"今天 "+t.getHours().toString().padStart(2,"0")+":"+t.getMinutes().toString().padStart(2,"0");const o=new Date;if(o.setDate(o.getDate()-1),t.toDateString()===o.toDateString())return"昨天 "+t.getHours().toString().padStart(2,"0")+":"+t.getMinutes().toString().padStart(2,"0");const l=["日","一","二","三","四","五","六"];return Math.floor((a-t)/864e5)<7?"星期"+l[t.getDay()]+" "+t.getHours().toString().padStart(2,"0")+":"+t.getMinutes().toString().padStart(2,"0"):t.getFullYear()!==a.getFullYear()?t.getFullYear()+"年"+(t.getMonth()+1)+"月"+t.getDate()+"日 "+t.getHours().toString().padStart(2,"0")+":"+t.getMinutes().toString().padStart(2,"0"):t.getMonth()+1+"月"+t.getDate()+"日 "+t.getHours().toString().padStart(2,"0")+":"+t.getMinutes().toString().padStart(2,"0")},formatTime:e=>{if(!e)return"";const t=new Date(e);return t.getHours().toString().padStart(2,"0")+":"+t.getMinutes().toString().padStart(2,"0")},formatDistance:e=>null==e?"":e<1e3?e+"米":(e/1e3).toFixed(1)+"公里",formatAvatarUrl:e=>{if(!e)return"/static/images/default-avatar.png";if(e.startsWith("http")||e.startsWith("/static"))return e;if(e.startsWith("/uploads")){return(u.index.getStorageSync("BASE_URL")||"http://49.235.65.37:5000")+e}return"/static/images/default-avatar.png"},onScroll:e=>{const t=e.detail.scrollTop,a=e.detail.scrollHeight,o=e.detail.scrollHeight-e.detail.scrollTop,s=a-t-o<50;I.value=s,b.value=!s,"nearby"===l.value?j.value={scrollTop:t,scrollHeight:a,clientHeight:o,atBottom:s}:U.value={scrollTop:t,scrollHeight:a,clientHeight:o,atBottom:s}},scrollToBottom:E}}};const M=u._export_sfc(T,[["render",function(e,t,a,o,l,s){return u.e({a:"nearby"===o.activeTab?1:"",b:u.o((e=>o.activeTab="nearby")),c:"city"===o.activeTab?1:"",d:u.o((e=>o.activeTab="city")),e:"nearby"===o.activeTab},"nearby"===o.activeTab?u.e({f:u.t(o.currentLocation.address||"正在获取位置..."),g:u.o(((...e)=>o.refreshLocation&&o.refreshLocation(...e))),h:o.noMoreNearbyMessages&&o.nearbyMessages.length>0},(o.noMoreNearbyMessages&&o.nearbyMessages.length,{}),{i:u.f(o.nearbyMessages,((e,t,a)=>u.e({a:o.shouldShowDate(e,t,o.nearbyMessages)},o.shouldShowDate(e,t,o.nearbyMessages)?{b:u.t(o.formatDate(e.createTime))}:{},{c:o.formatAvatarUrl(e.userAvatar),d:u.t(e.userName),e:u.t(o.formatTime(e.createTime)),f:u.t(e.content),g:e.distance},e.distance?{h:u.t(o.formatDistance(e.distance))}:{},{i:e.id||t,j:"nearby-msg-"+(e.id||t)}))),j:0===o.nearbyMessages.length&&!o.isLoading},0!==o.nearbyMessages.length||o.isLoading?{}:{k:p._imports_0$6},{l:o.isLoading},(o.isLoading,{}),{m:o.scrollTop,n:u.o(((...e)=>o.loadMoreNearbyMessages&&o.loadMoreNearbyMessages(...e))),o:u.o(((...e)=>o.onScroll&&o.onScroll(...e))),p:o.showBackToBottom},o.showBackToBottom?{q:u.o(((...e)=>o.scrollToBottom&&o.scrollToBottom(...e)))}:{}):{},{r:"city"===o.activeTab},"city"===o.activeTab?u.e({s:u.t(o.currentLocation.city||"正在获取城市..."),t:u.o(((...e)=>o.refreshLocation&&o.refreshLocation(...e))),v:o.noMoreCityMessages&&o.cityMessages.length>0},(o.noMoreCityMessages&&o.cityMessages.length,{}),{w:u.f(o.cityMessages,((e,t,a)=>u.e({a:o.shouldShowDate(e,t,o.cityMessages)},o.shouldShowDate(e,t,o.cityMessages)?{b:u.t(o.formatDate(e.createTime))}:{},{c:o.formatAvatarUrl(e.userAvatar),d:u.t(e.userName),e:u.t(o.formatTime(e.createTime)),f:u.t(e.content),g:e.id||t,h:"city-msg-"+(e.id||t)}))),x:0===o.cityMessages.length&&!o.isLoading},0!==o.cityMessages.length||o.isLoading?{}:{y:p._imports_0$6},{z:o.isLoading},(o.isLoading,{}),{A:o.cityScrollTop,B:u.o(((...e)=>o.loadMoreCityMessages&&o.loadMoreCityMessages(...e))),C:u.o(((...e)=>o.onScroll&&o.onScroll(...e))),D:o.showBackToBottom},o.showBackToBottom?{E:u.o(((...e)=>o.scrollToBottom&&o.scrollToBottom(...e)))}:{}):{},{F:o.inputFocus,G:u.o(((...e)=>o.sendMessage&&o.sendMessage(...e))),H:o.newMessage,I:u.o((e=>o.newMessage=e.detail.value)),J:o.newMessage.trim()?1:"",K:u.o(((...e)=>o.sendMessage&&o.sendMessage(...e)))})}]]);wx.createPage(M);
