"use strict";var e=(e,a,t)=>new Promise(((u,o)=>{var s=e=>{try{r(t.next(e))}catch(a){o(a)}},l=e=>{try{r(t.throw(e))}catch(a){o(a)}},r=e=>e.done?u(e.value):Promise.resolve(e.value).then(s,l);r((t=t.apply(e,a)).next())}));const a=require("../../common/vendor.js"),t=require("../../utils/ui.js"),u=require("../../utils/petAnalysisService.js"),o=require("../../store/user.js"),s=require("../../store/pet.js"),l={__name:"recognition",setup(l){const r=o.useUserStore();s.usePetStore();const n=a.ref(""),i=a.ref(!1),c=a.ref(null);function v(){return e(this,null,(function*(){try{const o=yield new Promise(((e,t)=>{a.index.chooseImage({count:1,sizeType:["compressed"],sourceType:["album","camera"],success:e,fail:t})}));n.value=o.tempFilePaths[0],function(){e(this,null,(function*(){if(!n.value)return t.showToast("请先选择图片");i.value=!0,t.showLoading("识别中...");try{const e=yield u.analyzePetImages([n.value]);console.log("识别服务返回结果:",e),e.identified?(c.value=e,console.log("识别成功:",c.value)):t.showToast(e.message||"识别失败，请重试")}catch(e){console.error("分析图片失败:",e),t.showToast("识别失败，请重试")}finally{i.value=!1,t.hideLoading()}}))}()}catch(o){console.error("选择图片失败:",o)}}))}function h(){n.value="",c.value=null}function d(){return c.value?r.isAuthenticated?void a.index.navigateTo({url:`/pages/pet/edit?mode=add&breed=${encodeURIComponent(c.value.breed)}&petType=${encodeURIComponent(c.value.petType||"dog")}`,success:()=>{t.showToast("请完善宠物信息")},fail:e=>{console.error("导航到宠物编辑页面失败:",e),t.showToast("操作失败，请重试")}}):t.showToast("请先登录"):t.showToast("没有识别结果")}return a.onMounted((()=>{r.isAuthenticated||(t.showToast("请先登录"),setTimeout((()=>{t.navigateBack()}),1500))})),(e,u)=>a.e({a:a.o(((...e)=>a.unref(t.navigateBack)&&a.unref(t.navigateBack)(...e))),b:n.value},n.value?{c:n.value}:{},{d:a.o(v),e:!i.value&&!c.value},(i.value||c.value,{}),{f:i.value},(i.value,{}),{g:c.value},c.value?a.e({h:a.t(c.value.breed),i:c.value.englishName},c.value.englishName?{j:a.t(c.value.englishName)}:{},{k:a.t(c.value.breedConfidence),l:a.t("dog"===c.value.petType?"狗":"cat"===c.value.petType?"猫":"未知"),m:c.value.purity},c.value.purity?{n:a.t(c.value.purity)}:{},{o:c.value.features||c.value.note},c.value.features||c.value.note?a.e({p:a.t(c.value.features),q:c.value.note},(c.value.note,{}),{r:c.value.note},c.value.note?{s:a.t(c.value.note)}:{}):{},{t:c.value.characteristics},c.value.characteristics?{v:c.value.characteristics.friendliness+"%",w:c.value.characteristics.activity+"%",x:c.value.characteristics.trainability+"%",y:c.value.characteristics.grooming+"%"}:{},{z:a.o(h),A:a.o(d)}):{})}};wx.createPage(l);
