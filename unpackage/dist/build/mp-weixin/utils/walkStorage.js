"use strict";var e=Object.defineProperty,t=Object.defineProperties,r=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,c=(t,r,o)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[r]=o,s=(e,t)=>{for(var r in t||(t={}))a.call(t,r)&&c(e,r,t[r]);if(o)for(var r of o(t))n.call(t,r)&&c(e,r,t[r]);return e},l=(e,o)=>t(e,r(o));const d=require("../common/vendor.js"),i="dog_walk_records",g=()=>{try{const e=d.index.getStorageSync(i);return e?JSON.parse(e):[]}catch(e){return console.error("获取本地遛狗记录失败:",e),[]}},u={getAllWalkRecords:g,getWalkRecord:e=>{try{const t=g().find((t=>t.id===e));return t?{code:0,message:"获取成功",data:t}:{code:404,message:"未找到记录",data:null}}catch(t){return console.error("获取遛狗记录失败:",t),{code:500,message:"获取失败",data:null}}},saveWalkRecord:e=>{try{const t=g(),r=`walk_${(new Date).getTime()}_${Math.floor(1e4*Math.random())}`,o=l(s({id:r},e),{createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()});return t.unshift(o),d.index.setStorageSync(i,JSON.stringify(t)),d.index.setStorageSync("last_walk_id",r),console.log("遛狗记录已保存到本地存储:",o),{code:0,message:"保存成功",data:{walkId:r}}}catch(t){return console.error("保存遛狗记录到本地失败:",t),{code:500,message:"保存失败",data:null}}},updateWalkRecord:(e,t)=>{try{const r=g(),o=r.findIndex((t=>t.id===e));return-1===o?(console.error("未找到要更新的遛狗记录:",e),{code:404,message:"未找到记录",data:null}):(r[o]=l(s(s({},r[o]),t),{updatedAt:(new Date).toISOString()}),d.index.setStorageSync(i,JSON.stringify(r)),console.log("遛狗记录已更新:",r[o]),{code:0,message:"更新成功",data:r[o]})}catch(r){return console.error("更新遛狗记录失败:",r),{code:500,message:"更新失败",data:null}}},deleteWalkRecord:e=>{try{const t=g(),r=t.filter((t=>t.id!==e));return t.length===r.length?{code:404,message:"未找到要删除的记录",data:null}:(d.index.setStorageSync(i,JSON.stringify(r)),console.log("遛狗记录已删除:",e),{code:0,message:"删除成功",data:null})}catch(t){return console.error("删除遛狗记录失败:",t),{code:500,message:"删除失败",data:null}}},getWalkStats:()=>{const e=g();let t=0,r=0;return e.forEach((e=>{t+=e.distance||0,r+=e.duration||0})),{totalRecords:e.length,totalDistance:t,totalDuration:r}}};exports.walkStorage=u;
