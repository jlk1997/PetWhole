"use strict";var t=Object.defineProperty,e=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,o=(e,s,n)=>s in e?t(e,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[s]=n,i=(t,i)=>{for(var r in i||(i={}))s.call(i,r)&&o(t,r,i[r]);if(e)for(var r of e(i))n.call(i,r)&&o(t,r,i[r]);return t};const r=require("../common/vendor.js");const a=new class{constructor(){this.status=r.reactive({isConnected:!0,networkType:"unknown",lastChecked:Date.now()}),this.listeners=[],this.checkNetworkStatus(),this.setupListeners()}setupListeners(){r.index.onNetworkStatusChange((t=>{this.handleNetworkChange(t)})),setInterval((()=>{this.checkNetworkStatus()}),3e4)}checkNetworkStatus(){return new Promise((t=>{r.index.getNetworkType({success:e=>{this.handleNetworkChange(e),t(this.status)},fail:()=>{this.handleNetworkChange({isConnected:!1,networkType:"none"}),t(this.status)}})}))}handleNetworkChange(t){const e=this.status.isConnected;this.status.isConnected=void 0!==t.isConnected?t.isConnected:"none"!==t.networkType,this.status.networkType=t.networkType||"unknown",this.status.lastChecked=Date.now(),console.log(`网络状态变化: ${this.status.isConnected?"在线":"离线"}, 类型: ${this.status.networkType}`),r.index.$emit("network:status-change",i({},this.status)),this.notifyListeners(),!e&&this.status.isConnected&&(console.log("网络已恢复连接"),r.index.$emit("network:reconnected",i({},this.status))),e&&!this.status.isConnected&&(console.log("网络已断开连接"),r.index.$emit("network:disconnected",i({},this.status)),r.index.showToast({title:"网络已断开，请检查网络连接",icon:"none",duration:2e3}))}addListener(t){return"function"!=typeof t?(console.error("网络状态监听器必须是函数"),()=>{}):(this.listeners.push(t),t(i({},this.status)),()=>{this.removeListener(t)})}removeListener(t){const e=this.listeners.indexOf(t);-1!==e&&this.listeners.splice(e,1)}notifyListeners(){const t=i({},this.status);this.listeners.forEach((e=>{try{e(t)}catch(s){console.error("网络状态监听器回调错误:",s)}}))}getStatus(){return i({},this.status)}isOnline(){return this.status.isConnected}isGoodConnection(){return!!this.status.isConnected&&("wifi"===this.status.networkType||"4g"===this.status.networkType||"5g"===this.status.networkType)}};exports.networkManager=a;
