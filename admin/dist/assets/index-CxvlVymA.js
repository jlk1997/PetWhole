import{g as Je,d as qe,u as Re}from"./index-DMQPIv9t.js";import{r as b,v as ze,c as be,A as De,b as G,o as $,d as s,i as ee,f as N,J as Te,e as t,w as o,g as y,k as H,L as He,p as i,t as _,M as Ke,D as Ae,N as Ue,O as Qe,P as Ie,Q as Xe,R as Ye,S as Ze,F as ce,h as $e,s as v,E as Le,U as et}from"./index-BZUGXbIj.js";import{_ as Fe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-xsH4HHeE.js";function tt(w){return Je("/admin/icons",w)}function ot(w){const m=new FormData;return m.append("file",w.file),m.append("name",w.name),m.append("type",w.type),w.description&&m.append("description",w.description),Re("/admin/icons/upload",m)}function at(w,m){const P=new FormData;return P.append("file",m),Re(`/admin/icons/${w}/replace`,P)}function lt(w){return qe(`/admin/icons/${w}`)}function Be(w,m){console.log("准备替换应用图标:",{fileName:w.name,fileSize:w.size,fileType:w.type,path:m.path,location:m.location});let P=m.path;P.startsWith("/")||(P="/"+P,console.log(`修正路径格式: ${m.path} -> ${P}`),m.path=P);const g=new FormData;g.append("file",w,w.name),m&&typeof m=="object"&&Object.keys(m).forEach(u=>{g.append(u,m[u]),console.log(`添加表单字段: ${u} = ${m[u]}`)});const F=localStorage.getItem("token");if(!F)return console.error("认证失败: 未找到token"),Promise.reject(new Error("未找到认证令牌"));console.log("FormData内容检查:");for(const u of g.entries())console.log(`${u[0]}: ${u[1]instanceof File?"文件对象":u[1]}`);const c=window.location.origin+m.path;console.log(`测试图片URL访问: ${c}`);const D=async u=>{if(!u.ok){const L=u.headers.get("content-type");if(L&&L.includes("application/json")){const B=await u.json();throw console.error("请求失败:",u.status,B),new Error(B.message||`请求失败: ${u.status}`)}else{const B=await u.text();throw console.error("请求失败 (非JSON响应):",u.status,B),new Error(`请求失败 (${u.status}): ${B.substring(0,100)}...`)}}return u},V=async u=>{try{const L=await fetch(u,{method:"HEAD",cache:"no-cache",headers:{"Cache-Control":"no-cache"}});if(L.status===404){console.warn(`文件不存在(404): ${u}，尝试直接GET请求验证...`);const B=await fetch(u,{method:"GET",cache:"no-cache",headers:{"Cache-Control":"no-cache"}});return B.ok?(console.log(`使用GET请求验证文件存在: ${u}`),!0):(console.error(`文件确实不存在: ${u}，HTTP状态: ${B.status}`),!1)}return L.ok}catch(L){return console.error(`检查文件存在性出错: ${u}`,L),!1}};return(async(u=2,L=1e3)=>{let B;for(let f=0;f<=u;f++)try{f>0&&(console.log(`重试替换请求 (${f}/${u})...`),await new Promise(k=>setTimeout(k,L)));const W=await fetch("/api/admin/icons/replace-app-icon",{method:"POST",body:g,headers:{Authorization:`Bearer ${F}`}});return await D(W),await W.json()}catch(W){console.error(`请求尝试 ${f+1} 失败:`,W),B=W}throw B||new Error("替换应用图标失败，已达到最大重试次数")})().then(async u=>{if(console.log("图标替换响应:",u),"caches"in window)try{const k=await caches.keys();for(const K of k)await caches.delete(K),console.log(`已清除缓存: ${K}`)}catch(k){console.error("清除缓存失败:",k)}(async()=>{const k=`${c}?t=${Date.now()}`;if(await new Promise(C=>setTimeout(C,1e3)),await V(k))console.log("文件验证成功，可以正常访问");else{console.error("上传后文件不存在，尝试同步操作");try{(await fetch("/api/admin/icons/sync",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${F}`},body:JSON.stringify({path:u.path})})).ok&&(console.log("同步请求发送成功，等待处理..."),await new Promise(U=>setTimeout(U,2e3)),await V(`${c}?t=${Date.now()}`)?console.log("同步后文件已存在"):console.error("同步后文件仍然不存在"))}catch(C){console.error("同步操作失败:",C)}}})().catch(k=>console.error("文件验证过程出错:",k)),(async()=>{try{await new Promise(C=>setTimeout(C,1500));const k=P.split("?")[0];console.log(`尝试强制刷新图标: ${k}`);const K=`blob_url_${k}`;if(sessionStorage.getItem(K)){const C=sessionStorage.getItem(K);sessionStorage.removeItem(K),console.log(`已从sessionStorage中移除缓存的blob URL: ${K} -> ${C}`);try{C&&C.startsWith("blob:")&&(URL.revokeObjectURL(C),console.log(`已释放旧的blob URL: ${C}`))}catch(x){console.warn("释放旧的blob URL失败，但不影响继续:",x)}}console.log(`尝试预加载并创建新的blob URL: ${k}`);try{const x=`http://localhost:3000${k}?t=${Date.now()}&r=${Math.random().toString(36).substring(2,8)}`,U=await fetch(x,{method:"GET",cache:"no-cache",headers:{"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"}});if(!U.ok)throw new Error(`获取图标失败: ${U.status} ${U.statusText}`);const Z=await U.blob();if(!Z.type.startsWith("image/"))throw new Error(`返回的数据不是图像: ${Z.type}`);const J=URL.createObjectURL(Z);console.log(`成功创建新的blob URL: ${J}`),sessionStorage.setItem(K,J);const ue=`img[src*="${k.split("/").pop()}"], img[data-path*="${k}"]`,le=document.querySelectorAll(ue);return console.log(`找到 ${le.length} 个匹配的图片元素需要更新`),le.forEach((re,ae)=>{const te=re.src;re.src=J,console.log(`已更新图片元素 ${ae+1}: ${te} -> ${J}`)}),console.log("图标预览刷新成功"),!0}catch(C){return console.error("预加载新图标失败:",C),!1}}catch(k){return console.error("清除图标缓存过程出错:",k),!1}})().catch(k=>console.error("清除图标缓存出错:",k));const f=new Image,W=Date.now();return f.src=`${c}?t=${W}`,f.onload=()=>console.log("图标加载成功:",f.src),f.onerror=k=>console.error("图标加载失败:",f.src,k),u}).catch(u=>{throw console.error("替换应用图标请求错误:",u),u})}function fe(w){if(!w)return"";let m=w;if(m.startsWith("http"))return m;if(m.includes("/api/admin/icons/view")){const g=m.split("/api/admin/icons/view");m=g[g.length-1]}m.startsWith("/")||(m="/"+m);const P="";return m.includes("/static/")?`${m}?t=${Date.now()}`:`${P}/api/admin/icons/view${m}?t=${Date.now()}`}function st(w='img[src*="/static/"]',m=!1){try{const P=document.querySelectorAll(w);console.log(`找到 ${P.length} 个匹配的图片`);let g=0;return P.forEach((F,c)=>{const D=F.src.split("?")[0],V=`${D}?t=${Date.now()}&r=${Math.random().toString(36).substring(2,8)}`;if(m){const E=new Image;E.crossOrigin="anonymous",E.onload=function(){console.log(`图片 ${c+1} 已重新加载: ${V}`)},E.onerror=function(){if(console.error(`图片 ${c+1} 加载失败: ${V}`),window.location.port==="5001"&&!D.includes("localhost:3000")){const L=`${D.replace("49.235.65.37:5001","localhost:3000")}?t=${Date.now()}&r=${Math.random().toString(36).substring(2,8)}`;console.log(`尝试从主应用服务器加载: ${L}`),E.src=L}},Array.from(F.attributes).forEach(u=>{u.name!=="src"&&E.setAttribute(u.name,u.value)}),E.src=V,F.parentNode&&F.parentNode.replaceChild(E,F)}else F.crossOrigin="anonymous",F.src=V,F.onerror=function(){if(window.location.port==="5001"&&!D.includes("localhost:3000")){const u=`${D.replace("49.235.65.37:5001","localhost:3000")}?t=${Date.now()}&r=${Math.random().toString(36).substring(2,8)}`;console.log(`尝试从主应用服务器加载: ${u}`),F.src=u}};g++}),console.log(`已刷新 ${g} 个图片`),g}catch(P){return console.error("刷新图片失败:",P),0}}async function nt(w){console.log(`开始强制刷新图片: ${w}`);let m=w;if(w.startsWith("http"))try{m=new URL(w).pathname}catch(c){console.warn(`解析URL失败: ${w}，使用原始路径`,c)}m.startsWith("/")||(m="/"+m);const g=`http://localhost:3000${m}`;console.log(`构建完整图片URL进行刷新（指向后端）: ${g}`);try{const c=`${g}${g.includes("?")?"&":"?"}t=${Date.now()}&nocache=true`;console.log(`使用fetch请求刷新图片: ${c}`);const D=await fetch(c,{method:"GET",cache:"no-cache",headers:{"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"}});if(D.ok){console.log(`图片fetch请求成功: ${c}`);const V=await D.blob();console.log(`已获取图片blob，大小: ${V.size} 字节, 类型: ${V.type}`);try{const E=URL.createObjectURL(V);console.log(`创建ObjectURL: ${E}`),document.querySelectorAll(`img[src*="${m.split("?")[0]}"]`).forEach(u=>{u.dataset.originalSrc||(u.dataset.originalSrc=u.src),u.src=E,console.log("已更新图片元素src为blob URL")})}catch(E){console.warn("创建blob URL失败:",E)}}else console.warn(`图片fetch请求失败: ${D.status} ${D.statusText}`)}catch(c){console.warn(`fetch刷新图片失败，将使用Image方式: ${c.message}`)}if("caches"in window)try{const c=await caches.keys();for(const D of c)await(await caches.open(D)).delete(g,{ignoreSearch:!0}),console.log(`已从缓存 ${D} 中清除图片: ${g}`)}catch(c){console.warn("清除缓存API失败，但不影响继续处理:",c)}const F=3;for(let c=0;c<F;c++){c>0&&(console.log(`尝试图片预加载 (${c+1}/${F})...`),await new Promise(D=>setTimeout(D,500)));try{const D=Date.now(),V=Math.random().toString(36).substring(2,8),E=`${g}${g.includes("?")?"&":"?"}t=${D}&r=${V}&a=${c}`;if(await new Promise(L=>{const B=new Image;B.onload=function(){console.log(`图片预加载成功 (尝试 ${c+1}): ${E}`),L(!0)},B.onerror=function(f){console.warn(`预加载图片失败 (尝试 ${c+1}): ${E}`,f),L(!1)},B.crossOrigin="anonymous",B.src=E,setTimeout(()=>{B.complete||(console.warn(`图片加载超时 (尝试 ${c+1}): ${E}`),L(!1))},3e3)}))return console.log(`图片成功刷新: ${w}`),!0}catch(D){console.warn(`图片刷新过程中出错 (尝试 ${c+1}):`,D)}}return console.log(`多次预加载尝试均失败，但图标可能已更新: ${w}`),!0}function rt(w){return console.log(`请求服务器清除缓存: ${w}`),fetch("/api/admin/cache/purge",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({path:w})}).then(m=>m.ok?m.json():m.json().then(P=>(console.warn("服务器清除缓存请求失败:",P),{success:!1,message:P.message||"请求失败"}))).then(m=>(console.log("服务器清除缓存结果:",m),m)).catch(m=>(console.error("清除缓存请求错误:",m),{success:!1,message:m.message||"请求错误"}))}const it={class:"icon-status-monitor"},ct={class:"monitor-header"},ut={style:{"margin-top":"10px"}},dt={key:0,class:"error-details"},pt={class:"status-filters"},mt={class:"image-error"},ft={class:"status-cell"},gt={class:"status-cell"},vt={class:"status-cell"},ht={class:"status-cell"},yt={key:0,class:"sync-details"},_t={key:0,class:"icon-details"},wt={class:"icon-preview"},$t={class:"image-error large"},bt={class:"detail-item"},kt={key:0},xt={class:"detail-item"},St={key:0},Et={class:"detail-item"},Ct={key:0},Vt={class:"detail-item"},Ut={key:0},It={class:"current-icon-preview"},zt={class:"image-error"},Tt={class:"dialog-footer"},Mt={__name:"IconStatusMonitor",setup(w){const m=window.location.origin,P=b(!1),g=b([]),F=b(""),c=b(""),D=ze({}),V=b(!1),E=b(!1),u=b(""),L=b([]),B=b(!1),f=b(null),W=b(!1),k=b(null),K=b(!1),C=b(!1),x=b(""),U=b(""),Z=b(!1),J=be(()=>g.value.filter(d=>{const r=!c.value||d.path.toLowerCase().includes(c.value.toLowerCase());let R=!0;return F.value==="consistent"?R=d.isConsistent:F.value==="inconsistent"?R=!d.isConsistent&&!d.hasMissing:F.value==="missing"&&(R=d.hasMissing),r&&R})),ue=be(()=>g.value.some(d=>!d.isConsistent));async function le(){P.value=!0;let d=0;const r=3;C.value=!1,x.value="",U.value="";const R=async()=>{try{console.log("请求图标状态信息，尝试次数:",d+1);const j=await fetch("/api/admin/icons/status",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`},signal:AbortSignal.timeout(1e4)});if(!j.ok){const I=await j.text();if(console.error(`服务器错误 (${j.status}):`,I),j.status===500){C.value=!0,x.value=`服务器内部错误 (${j.status})`;try{const se=JSON.parse(I);U.value=se.message||I}catch{U.value=I}}throw new Error(`服务器错误: ${j.status}`)}const O=j.headers.get("content-type");if(!O||!O.includes("application/json"))throw console.error("响应不是JSON格式:",O),C.value=!0,x.value="响应格式错误，不是JSON",U.value=`Content-Type: ${O}`,new Error("响应格式错误，不是JSON");const A=await j.json();return A.success?(C.value=!1,g.value=(A.data||[]).map(I=>({...I,isConsistent:I.devExists&&I.h5Exists&&I.wxExists&&I.appExists&&I.devMd5===I.h5Md5&&I.devMd5===I.wxMd5&&I.devMd5===I.appMd5,hasMissing:!I.devExists||!I.h5Exists||!I.wxExists||!I.appExists})),v.success("图标状态刷新成功"),!0):(C.value=!0,x.value=A.message||"获取图标状态失败",v.error(A.message||"获取图标状态失败"),!1)}catch(j){return console.error("刷新图标状态失败:",j),d<r?(d++,v.warning(`请求失败，正在重试 (${d}/${r})...`),await new Promise(O=>setTimeout(O,1e3)),R()):(C.value||(C.value=!0,x.value=j.message||"未知错误",U.value=j.stack||""),v.error("刷新图标状态失败: "+j.message),!1)}};try{await R()}finally{P.value=!1}}async function re(d){if(!d.devExists){v.warning("开发环境文件不存在，无法同步");return}try{D[d.path]=!0,await Le.confirm(`确定要将图标 "${ge(d.path)}" 同步到所有环境吗？`,"同步确认",{confirmButtonText:"确定同步",cancelButtonText:"取消",type:"warning"}),L.value=[],ae(!0,`开始同步图标: ${d.path}`);let r=0;const R=2,j=async()=>{try{console.log(`发送同步请求，尝试次数: ${r+1}`);const A=await fetch("/api/admin/icons/sync",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({path:d.path}),signal:AbortSignal.timeout(15e3)});if(!A.ok){const se=await A.text();throw console.error(`同步请求错误 (${A.status}):`,se),ae(!1,`服务器响应错误: ${A.status}`),new Error(`同步失败: ${A.status}`)}const I=A.headers.get("content-type");if(!I||!I.includes("application/json"))throw console.error("响应不是JSON格式:",I),ae(!1,"服务器响应格式错误"),new Error("响应格式错误，不是JSON");return await A.json()}catch(A){if(console.error("同步请求失败:",A),r<R)return r++,ae(!1,`请求失败，正在重试 (${r}/${R})...`),await new Promise(I=>setTimeout(I,1e3)),j();throw A}},O=await j();O.success?(E.value=!0,u.value=O.message||"图标同步成功",O.details&&Array.isArray(O.details)&&O.details.forEach(A=>{ae(A.success,A.message)}),await le()):(E.value=!1,u.value=O.message||"图标同步失败",O.errors&&Array.isArray(O.errors)&&O.errors.forEach(A=>{ae(!1,A.message||"未知错误")})),V.value=!0}catch(r){if(r==="cancel"||r.message==="cancel")return;console.error("同步图标失败:",r),v.error("同步图标失败: "+r.message),ae(!1,`同步过程出错: ${r.message}`),E.value=!1,u.value="同步过程出错",V.value=!0}finally{D[d.path]=!1}}function ae(d,r){L.value.push({success:d,message:r,timestamp:new Date().toLocaleTimeString()})}function te(d){f.value=d,B.value=!0}function ke(d){f.value=d,k.value=null,W.value=!0}function ye(d){if(d){if(!["image/jpeg","image/png","image/svg+xml","image/webp"].includes(d.raw.type))return v.error("只能上传JPG/PNG/SVG/WebP格式的图片"),!1;const R=2*1024*1024;return d.size>R?(v.error("图片大小不能超过2MB"),!1):(k.value=d.raw,!0)}return!1}async function xe(){if(!k.value){v.warning("请先选择图标文件");return}if(!f.value||!f.value.path){v.error("没有选择要替换的图标");return}K.value=!0;try{const d=await Be(k.value,{path:f.value.path,location:ge(f.value.path)});d&&d.success?(v.success("图标替换成功"),W.value=!1,setTimeout(()=>le(),1e3)):v.error((d==null?void 0:d.message)||"替换图标失败")}catch(d){console.error("上传图标失败:",d),v.error("上传图标失败: "+(d.message||"未知错误"))}finally{K.value=!1}}function ge(d){return d?d.split("/").pop():""}function de(d){if(d===0||!d)return"0 B";const r=["B","KB","MB","GB"],R=Math.floor(Math.log(d)/Math.log(1024));return parseFloat((d/Math.pow(1024,R)).toFixed(2))+" "+r[R]}function Se(d){return d?new Date(d).toLocaleString():"未知"}function ie(d){if(!d)return"";const r=Date.now();return`${m}${d}?t=${r}`}return De(()=>{le()}),(d,r)=>{const R=y("el-button"),j=y("el-tooltip"),O=y("el-alert"),A=y("el-option"),I=y("el-select"),se=y("el-input"),ne=y("el-icon"),ve=y("el-image"),oe=y("el-table-column"),Q=y("el-tag"),pe=y("el-link"),Ee=y("el-table"),Ce=y("el-result"),a=y("el-timeline-item"),e=y("el-timeline"),l=y("el-dialog"),z=y("el-descriptions-item"),T=y("el-descriptions"),M=y("el-form-item"),h=y("el-upload"),S=y("el-form"),X=Ae("loading");return $(),G("div",it,[s("div",ct,[r[9]||(r[9]=s("h3",null,"图标环境监控",-1)),t(j,{content:"刷新图标状态信息",placement:"top"},{default:o(()=>[t(R,{type:"primary",icon:H(He),circle:"",size:"small",onClick:le,loading:P.value},null,8,["icon","loading"])]),_:1})]),C.value?($(),ee(O,{key:0,type:"error",closable:!1,"show-icon":"",style:{"margin-bottom":"15px"}},{title:o(()=>[s("span",null,"服务器错误: "+_(x.value),1)]),default:o(()=>[s("div",ut,[t(R,{type:"primary",size:"small",onClick:le},{default:o(()=>r[10]||(r[10]=[i("重试")])),_:1}),t(R,{size:"small",onClick:r[0]||(r[0]=n=>Z.value=!Z.value)},{default:o(()=>[i(_(Z.value?"隐藏详情":"显示详情"),1)]),_:1})]),Z.value?($(),G("div",dt,[s("pre",null,_(U.value),1)])):N("",!0)]),_:1})):N("",!0),ue.value&&!C.value?($(),ee(O,{key:1,type:"warning",closable:!1,"show-icon":""},{default:o(()=>r[11]||(r[11]=[s("b",null,"检测到环境不一致",-1),i(": 部分图标在不同环境中存在差异，请注意处理 ")])),_:1})):N("",!0),s("div",pt,[t(I,{modelValue:F.value,"onUpdate:modelValue":r[1]||(r[1]=n=>F.value=n),placeholder:"状态筛选",size:"small",clearable:""},{default:o(()=>[t(A,{label:"全部",value:""}),t(A,{label:"一致",value:"consistent"}),t(A,{label:"不一致",value:"inconsistent"}),t(A,{label:"缺失",value:"missing"})]),_:1},8,["modelValue"]),t(se,{modelValue:c.value,"onUpdate:modelValue":r[2]||(r[2]=n=>c.value=n),placeholder:"搜索路径",size:"small",clearable:"","prefix-icon":H(Ke)},null,8,["modelValue","prefix-icon"])]),Te(($(),ee(Ee,{data:J.value,stripe:"",border:"",size:"small"},{default:o(()=>[t(oe,{label:"图标",width:"80"},{default:o(({row:n})=>[t(ve,{src:ie(n.path),fit:"contain",style:{width:"30px",height:"30px"},"preview-src-list":[ie(n.path)],"initial-index":0},{error:o(()=>[s("div",mt,[t(ne,null,{default:o(()=>[t(H(Ue))]),_:1})])]),_:2},1032,["src","preview-src-list"])]),_:1}),t(oe,{prop:"path",label:"路径","min-width":"200","show-overflow-tooltip":""}),t(oe,{label:"开发环境",width:"100"},{default:o(({row:n})=>[s("div",ft,[t(Q,{type:n.devExists?"success":"danger",size:"small"},{default:o(()=>[i(_(n.devExists?"存在":"缺失"),1)]),_:2},1032,["type"]),n.devExists?($(),ee(j,{key:0,content:"在浏览器中查看",placement:"top"},{default:o(()=>[t(pe,{type:"primary",href:ie(n.path),target:"_blank",underline:!1},{default:o(()=>[t(ne,null,{default:o(()=>[t(H(Qe))]),_:1})]),_:2},1032,["href"])]),_:2},1024)):N("",!0)])]),_:1}),t(oe,{label:"H5生产",width:"100"},{default:o(({row:n})=>[s("div",gt,[t(Q,{type:n.h5Exists?"success":"danger",size:"small"},{default:o(()=>[i(_(n.h5Exists?"存在":"缺失"),1)]),_:2},1032,["type"]),n.devExists&&n.h5Exists&&n.devMd5!==n.h5Md5?($(),ee(ne,{key:0,color:"#E6A23C"},{default:o(()=>[t(H(Ie))]),_:1})):N("",!0)])]),_:1}),t(oe,{label:"小程序",width:"100"},{default:o(({row:n})=>[s("div",vt,[t(Q,{type:n.wxExists?"success":"danger",size:"small"},{default:o(()=>[i(_(n.wxExists?"存在":"缺失"),1)]),_:2},1032,["type"]),n.devExists&&n.wxExists&&n.devMd5!==n.wxMd5?($(),ee(ne,{key:0,color:"#E6A23C"},{default:o(()=>[t(H(Ie))]),_:1})):N("",!0)])]),_:1}),t(oe,{label:"APP",width:"100"},{default:o(({row:n})=>[s("div",ht,[t(Q,{type:n.appExists?"success":"danger",size:"small"},{default:o(()=>[i(_(n.appExists?"存在":"缺失"),1)]),_:2},1032,["type"]),n.devExists&&n.appExists&&n.devMd5!==n.appMd5?($(),ee(ne,{key:0,color:"#E6A23C"},{default:o(()=>[t(H(Ie))]),_:1})):N("",!0)])]),_:1}),t(oe,{label:"状态",width:"120"},{default:o(({row:n})=>[t(Q,{type:n.isConsistent?"success":n.hasMissing?"danger":"warning",size:"small"},{default:o(()=>[i(_(n.isConsistent?"一致":n.hasMissing?"部分缺失":"内容不一致"),1)]),_:2},1032,["type"])]),_:1}),t(oe,{label:"操作",width:"160"},{default:o(({row:n})=>[t(j,{content:"同步到所有环境",placement:"top"},{default:o(()=>[t(R,{type:"primary",size:"small",icon:H(Xe),disabled:!n.devExists,onClick:q=>re(n),loading:D[n.path]},null,8,["icon","disabled","onClick","loading"])]),_:2},1024),t(j,{content:"替换图标",placement:"top"},{default:o(()=>[t(R,{type:"success",size:"small",icon:H(Ye),onClick:q=>ke(n)},null,8,["icon","onClick"])]),_:2},1024),t(j,{content:"详细信息",placement:"top"},{default:o(()=>[t(R,{type:"info",size:"small",icon:H(Ze),onClick:q=>te(n)},null,8,["icon","onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[X,P.value]]),t(l,{modelValue:V.value,"onUpdate:modelValue":r[4]||(r[4]=n=>V.value=n),title:"同步结果",width:"500px"},{default:o(()=>[t(Ce,{icon:E.value?"success":"error",title:E.value?"同步成功":"同步失败","sub-title":u.value},{extra:o(()=>[t(R,{type:"primary",onClick:r[3]||(r[3]=n=>V.value=!1)},{default:o(()=>r[12]||(r[12]=[i("确定")])),_:1})]),_:1},8,["icon","title","sub-title"]),L.value.length?($(),G("div",yt,[r[13]||(r[13]=s("h4",null,"同步详情:",-1)),t(e,null,{default:o(()=>[($(!0),G(ce,null,$e(L.value,(n,q)=>($(),ee(a,{key:q,type:n.success?"success":"danger",timestamp:n.timestamp},{default:o(()=>[i(_(n.message),1)]),_:2},1032,["type","timestamp"]))),128))]),_:1})])):N("",!0)]),_:1},8,["modelValue"]),t(l,{modelValue:B.value,"onUpdate:modelValue":r[5]||(r[5]=n=>B.value=n),title:"图标详细信息",width:"600px"},{default:o(()=>[f.value?($(),G("div",_t,[s("div",wt,[t(ve,{src:ie(f.value.path),fit:"contain",style:{width:"100px",height:"100px"}},{error:o(()=>[s("div",$t,[t(ne,null,{default:o(()=>[t(H(Ue))]),_:1})])]),_:1},8,["src"])]),t(T,{column:1,border:""},{default:o(()=>[t(z,{label:"路径"},{default:o(()=>[i(_(f.value.path),1)]),_:1}),t(z,{label:"文件名"},{default:o(()=>[i(_(ge(f.value.path)),1)]),_:1}),t(z,{label:"开发环境"},{default:o(()=>[s("div",bt,[s("span",null,_(f.value.devExists?"存在":"缺失"),1),f.value.devExists?($(),G("span",kt,[t(Q,{size:"small"},{default:o(()=>[i("MD5: "+_(f.value.devMd5.substring(0,8)),1)]),_:1}),t(Q,{size:"small"},{default:o(()=>[i("大小: "+_(de(f.value.devSize)),1)]),_:1})])):N("",!0)])]),_:1}),t(z,{label:"H5生产环境"},{default:o(()=>[s("div",xt,[s("span",null,_(f.value.h5Exists?"存在":"缺失"),1),f.value.h5Exists?($(),G("span",St,[t(Q,{size:"small"},{default:o(()=>[i("MD5: "+_(f.value.h5Md5.substring(0,8)),1)]),_:1}),t(Q,{size:"small"},{default:o(()=>[i("大小: "+_(de(f.value.h5Size)),1)]),_:1})])):N("",!0)])]),_:1}),t(z,{label:"微信小程序"},{default:o(()=>[s("div",Et,[s("span",null,_(f.value.wxExists?"存在":"缺失"),1),f.value.wxExists?($(),G("span",Ct,[t(Q,{size:"small"},{default:o(()=>[i("MD5: "+_(f.value.wxMd5.substring(0,8)),1)]),_:1}),t(Q,{size:"small"},{default:o(()=>[i("大小: "+_(de(f.value.wxSize)),1)]),_:1})])):N("",!0)])]),_:1}),t(z,{label:"APP环境"},{default:o(()=>[s("div",Vt,[s("span",null,_(f.value.appExists?"存在":"缺失"),1),f.value.appExists?($(),G("span",Ut,[t(Q,{size:"small"},{default:o(()=>[i("MD5: "+_(f.value.appMd5.substring(0,8)),1)]),_:1}),t(Q,{size:"small"},{default:o(()=>[i("大小: "+_(de(f.value.appSize)),1)]),_:1})])):N("",!0)])]),_:1}),t(z,{label:"最后更新"},{default:o(()=>[i(_(f.value.lastUpdated?Se(f.value.lastUpdated):"未知"),1)]),_:1})]),_:1})])):N("",!0)]),_:1},8,["modelValue"]),t(l,{modelValue:W.value,"onUpdate:modelValue":r[8]||(r[8]=n=>W.value=n),title:"上传替换图标",width:"500px"},{footer:o(()=>[s("div",Tt,[t(R,{onClick:r[7]||(r[7]=n=>W.value=!1)},{default:o(()=>r[16]||(r[16]=[i("取消")])),_:1}),t(R,{type:"primary",onClick:xe,loading:K.value},{default:o(()=>r[17]||(r[17]=[i(" 上传并同步到所有环境 ")])),_:1},8,["loading"])])]),default:o(()=>[f.value?($(),ee(S,{key:0,"label-position":"top"},{default:o(()=>[t(M,{label:"图标路径"},{default:o(()=>[t(se,{modelValue:f.value.path,"onUpdate:modelValue":r[6]||(r[6]=n=>f.value.path=n),disabled:""},null,8,["modelValue"])]),_:1}),t(M,{label:"当前图标"},{default:o(()=>[s("div",It,[t(ve,{src:ie(f.value.path),fit:"contain",style:{width:"80px",height:"80px"}},{error:o(()=>[s("div",zt,[t(ne,null,{default:o(()=>[t(H(Ue))]),_:1})])]),_:1},8,["src"])])]),_:1}),t(M,{label:"上传新图标"},{default:o(()=>[t(h,{class:"icon-uploader","show-file-list":!0,limit:1,accept:"image/*","auto-upload":!1,"on-change":ye},{trigger:o(()=>[t(R,{type:"primary"},{default:o(()=>r[14]||(r[14]=[i("选择文件")])),_:1})]),tip:o(()=>r[15]||(r[15]=[s("div",{class:"el-upload__tip"}," 只能上传 JPG/PNG/SVG/WebP 文件，且大小不超过 2MB ",-1)])),_:1})]),_:1})]),_:1})):N("",!0)]),_:1},8,["modelValue"])])}}},Pt=Fe(Mt,[["__scopeId","data-v-2980bc97"]]),Rt={class:"icons-container"},Dt={class:"page-header"},At={class:"page-header-actions"},Lt={style:{"margin-bottom":"15px"}},Ft={class:"icon-preview icon-preview-wrapper"},Bt=["src","alt","data-path"],jt={class:"pagination-container"},Nt={key:1},Ot={style:{"margin-bottom":"15px",display:"flex","justify-content":"space-between","align-items":"center"}},Gt={class:"icon-usage-list"},Wt={class:"usage-icon-content"},Jt={class:"usage-icon-preview icon-preview-wrapper"},qt=["src","alt","data-path"],Ht={key:0,class:"loading-indicator"},Kt={class:"usage-icon-info"},Qt={class:"usage-icon-path"},Xt={class:"usage-icon-actions"},Yt={key:2},Zt={class:"dialog-footer"},eo={class:"current-icon icon-preview-wrapper"},to=["src","alt","data-path"],oo={class:"new-icon"},ao={class:"dialog-footer"},lo={class:"icon-preview-wrapper"},so=["src","alt","data-path"],no={class:"icon-info"},ro={key:0},io={class:"current-icon icon-preview-wrapper"},co=["src","alt","data-path"],uo={class:"new-icon"},po={class:"dialog-footer"},mo={__name:"index",setup(w){const m=[{value:"app",label:"应用图标"},{value:"tab",label:"标签栏图标"},{value:"marker",label:"地图标记"},{value:"pet",label:"宠物图标"},{value:"user",label:"用户相关"},{value:"common",label:"通用图标"},{value:"ui",label:"界面元素"},{value:"action",label:"操作按钮"},{value:"status",label:"状态图标"},{value:"social",label:"社交图标"}],P=[{type:"app",location:"应用启动图标",path:"/static/images/logo.png"},{type:"app",location:"主界面图标",path:"/static/images/logo-text.png"},{type:"tab",location:"标签栏-地图(未选中)",path:"/static/images/map-icon.png"},{type:"tab",location:"标签栏-地图(选中)",path:"/static/images/map-icon-active.png"},{type:"tab",location:"标签栏-社区(未选中)",path:"/static/images/community-icon.png"},{type:"tab",location:"标签栏-社区(选中)",path:"/static/images/community-icon-active.png"},{type:"tab",location:"标签栏-聊天(未选中)",path:"/static/images/chat-icon.png"},{type:"tab",location:"标签栏-聊天(选中)",path:"/static/images/chat-icon-active.png"},{type:"tab",location:"标签栏-我的(未选中)",path:"/static/images/profile-icon.png"},{type:"tab",location:"标签栏-我的(选中)",path:"/static/images/profile-icon-active.png"},{type:"marker",location:"普通标记",path:"/static/images/marker.png"},{type:"marker",location:"宠物友好标记",path:"/static/images/pet-marker.png"},{type:"marker",location:"危险区域标记",path:"/static/images/danger-marker.png"},{type:"marker",location:"公园/风景标记",path:"/static/images/park-marker.png"},{type:"marker",location:"商店/服务标记",path:"/static/images/shop-marker.png"},{type:"marker",location:"食品标记",path:"/static/images/food-marker.png"},{type:"marker",location:"当前位置标记",path:"/static/images/current-location.png"},{type:"user",location:"默认用户头像",path:"/static/images/default-avatar.png"},{type:"user",location:"用户标记图标",path:"/static/images/user-marker.png"},{type:"pet",location:"默认宠物头像",path:"/static/images/default-pet.png"},{type:"pet",location:"宠物标记图标",path:"/static/images/pet-marker.png"},{type:"ui",location:"默认地图",path:"/static/images/default-map.png"},{type:"ui",location:"默认图片",path:"/static/images/default-image.png"},{type:"action",location:"点赞图标",path:"/static/images/like-icon.png"},{type:"action",location:"评论图标",path:"/static/images/comment-icon.png"},{type:"action",location:"分享图标",path:"/static/images/share-icon.png"},{type:"action",location:"删除图标",path:"/static/images/delete-icon.png"}],g=ze({name:"",type:"",status:""}),F=b(null),c=ze({name:"",type:"",description:"",file:null}),D={name:[{required:!0,message:"请输入图标名称",trigger:"blur"},{min:2,max:20,message:"长度在 2 到 20 个字符",trigger:"blur"}],type:[{required:!0,message:"请选择图标类型",trigger:"change"}],file:[{required:!0,message:"请上传图标文件",trigger:"change"}]},V=b("icons"),E=b("app"),u=b(1),L=b(10),B=b(0),f=b(!1),W=b(!1),k=b(!1),K=b(!1),C=b(!1),x=b(null),U=b(null),Z=b(null),J=b(null),ue=b([]),le=be(()=>{let a=[...ue.value];return g.name&&(a=a.filter(e=>e.name.toLowerCase().includes(g.name.toLowerCase()))),g.type&&(a=a.filter(e=>e.type===g.type)),g.status&&(a=a.filter(e=>g.status==="used"&&e.used||g.status==="unused"&&!e.used)),a}),re=be(()=>P.filter(a=>a.type===E.value)),ae=async()=>{v.info({message:"正在刷新图标，请稍候...",duration:3e3});const a=[];try{const e=st('img[src*="/static/"]',!0);if(console.log(`已强制刷新 ${e} 个图标图像`),U.value&&U.value.path)try{const l=U.value.path;console.log(`准备刷新当前图标: ${l}`);const z=await nt(l);console.log(`强制刷新当前图标${z?"成功":"可能需要进一步处理"}: ${l}`);const T=`img[src*="${l.split("?")[0]}"]`,M=document.querySelectorAll(T);if(console.log(`找到 ${M.length} 个匹配图标元素`),M.length>0){const h=Date.now(),S=Math.random().toString(36).substring(2,8);M.forEach((X,n)=>{try{const Y=`${X.src.split("?")[0]}?t=${h}&r=${S}`;X.src=Y,console.log(`更新图标元素 ${n+1} 的src: ${Y}`)}catch(q){console.warn(`无法更新元素 ${n+1}:`,q)}})}try{const h=l+"?t="+Date.now(),S=await fetch(h,{method:"GET",cache:"no-cache",headers:{"Cache-Control":"no-cache"}});console.log(`图标文件HTTP状态: ${S.status} ${S.statusText}`),S.ok||(console.warn(`无法加载图标文件(${S.status}): ${h}`),a.push(`图标文件请求返回非成功状态(${S.status}): ${l}`))}catch(h){console.warn("请求图标失败，但这可能是暂时的:",h),a.push(`请求图标文件异常: ${h.message}`)}}catch(l){console.warn("刷新当前图标过程中出现问题:",l),a.push(`刷新当前图标过程出错: ${l.message}`)}if(V.value==="usage"){const l=V.value,z=E.value;V.value="icons",setTimeout(()=>{V.value=l,E.value=z},100)}try{console.log("请求服务器清除静态文件缓存"),await rt("/static/")}catch(l){console.warn("清除服务器缓存失败，但不影响主要功能:",l),a.push(`清除服务器缓存失败: ${l.message}`)}a.length>0?console.warn("图标刷新过程中有一些问题:",a):v.success("图标刷新成功")}catch(e){console.error("刷新图标过程中出现异常:",e),v.warning({message:"刷新图标过程中出现问题，但图标可能已替换成功",duration:3e3})}setTimeout(()=>{const e=document.querySelectorAll('img[src*="/static/"]');if(console.log(`找到 ${e.length} 个图标元素，尝试强制刷新`),e.length>0){const l=Date.now();e.forEach((z,T)=>{try{const M=z.src.split("?")[0],h=Math.random().toString(36).substring(2,8);z.src=`${M}?t=${l}&r=${h}`,console.log(`已刷新图标元素 ${T+1}`)}catch(M){console.warn(`刷新元素 ${T+1} 失败:`,M)}})}},500)};De(async()=>{await te(),console.log("初始化完成，刷新图标预览...");try{pe().catch(a=>{console.warn("初始化时刷新图标预览失败:",a)})}catch(a){console.warn("初始化刷新预览失败:",a)}});const te=async()=>{f.value=!0;try{const a=await tt({page:u.value,limit:L.value,type:g.type,search:g.name,used:g.status==="used"?!0:g.status==="unused"?!1:void 0});a&&a.success&&a.data?(ue.value=a.data.items,B.value=a.data.total):v.warning("获取图标列表失败")}catch(a){console.error("获取图标列表错误:",a),v.error("获取图标列表失败")}finally{f.value=!1}},ke=()=>{g.name="",g.type="",g.status="",te()},ye=()=>{c.name="",c.type="",c.description="",c.file=null,W.value=!0},xe=a=>{c.file=a.raw},ge=()=>{c.file=null},de=a=>{x.value=a,K.value=!0},Se=a=>{x.value=a,Z.value=null,k.value=!0},ie=a=>{Z.value=a.raw},d=()=>{Z.value=null},r=a=>{U.value=a,J.value=null,C.value=!0},R=a=>{J.value=a.raw},j=()=>{J.value=null},O=async()=>{var e;if(!J.value){v.warning("请先选择替换文件");return}const a=v({message:"正在替换图标，请稍候...",type:"info",duration:0});try{const l=U.value.path;if(console.log("开始替换应用图标:",{fileName:J.value.name,fileType:J.value.type,fileSize:J.value.size,targetPath:l,location:U.value.location}),!["image/png","image/jpeg","image/gif","image/svg+xml","image/webp"].includes(J.value.type)){a.close(),v.error(`不支持的文件类型: ${J.value.type}，请使用PNG、JPG、GIF、SVG或WEBP格式`);return}const T=5;if(J.value.size>T*1024*1024){a.close(),v.error(`文件大小超过${T}MB限制`);return}try{const h=`${window.location.origin}${l}`;console.log(`检查目标图标是否存在: ${h}`);const S=new Image;S.onerror=()=>console.log(`目标图标不存在，将创建新文件: ${h}`),S.onload=()=>console.log(`目标图标已存在: ${h}`),S.src=h}catch(h){console.warn("检查图标存在性失败:",h)}const M=await Be(J.value,{path:l,location:U.value.location});a.close(),M&&M.success?(v.success("图标替换成功"),C.value=!1,setTimeout(async()=>{navigator.serviceWorker&&navigator.serviceWorker.controller&&navigator.serviceWorker.controller.postMessage({type:"CLEAR_IMAGES_CACHE"}),await new Promise(h=>setTimeout(h,1e3));try{await Q(l)?console.log(`成功刷新替换后的图标预览: ${l}`):(console.warn("单个图标刷新失败，尝试刷新所有图标..."),await pe()),te()}catch(h){console.error("刷新图标过程中出错:",h),ae()}},1e3)):(v.error((M==null?void 0:M.message)||"替换应用图标失败"),console.error("替换失败响应:",M))}catch(l){a.close(),console.error("替换应用图标失败:",l);let z="替换应用图标失败";l.response?z+=`: ${((e=l.response.data)==null?void 0:e.message)||l.message||"未知错误"}`:l.message&&(z+=`: ${l.message}`),v.error(z)}},A=async()=>{if(!c.file){v.warning("请先选择图标文件");return}try{await F.value.validate()}catch{return}try{const a=new FormData;a.append("name",c.name),a.append("type",c.type),a.append("description",c.description),a.append("file",c.file);const e=await ot(c.file,{name:c.name,type:c.type,description:c.description});e&&e.success?(v.success("上传成功"),W.value=!1,te()):v.error((e==null?void 0:e.message)||"上传失败")}catch(a){console.error("上传失败:",a),v.error("上传失败: "+(a.message||"未知错误"))}},I=async()=>{if(!Z.value){v.warning("请先选择替换文件");return}try{const a=await at(x.value.id,Z.value);a&&a.success?(v.success("替换成功"),k.value=!1,te()):v.error((a==null?void 0:a.message)||"替换失败")}catch(a){console.error("替换失败:",a),v.error("替换失败: "+(a.message||"未知错误"))}},se=a=>{if(a.used){v.warning("该图标正在使用中，无法删除");return}Le.confirm("确定要删除该图标吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const e=await lt(a.id);e&&e.success?(v.success("删除成功"),te()):v.error((e==null?void 0:e.message)||"删除失败")}catch(e){console.error("删除失败:",e),v.error("删除失败: "+(e.message||"未知错误"))}}).catch(()=>{})},ne=a=>{L.value=a,te()},ve=a=>{u.value=a,te()},oe=b(!1),Q=async(a,e)=>{try{let l=a;if(l.startsWith("http"))try{l=new URL(l).pathname}catch(T){console.warn("解析URL失败:",T)}if(l.startsWith("/")||(l="/"+l),l.includes("/api/admin/icons/view")){const T=l.split("/api/admin/icons/view");l=T[T.length-1]}const z=fe(l);return e&&(e.dataset.originalSrc=l,e.src=z),!0}catch(l){return console.error("强制刷新图标预览失败:",l),!1}},pe=async()=>{oe.value=!0;try{console.log("开始刷新所有图标预览...");const a=new Set;P.forEach(h=>a.add(h.path)),U.value&&U.value.path&&a.add(U.value.path);const e=document.querySelectorAll('img[src*="/static/"]');console.log(`找到 ${e.length} 个可见图标元素`),e.forEach(h=>{try{const S=h.src.split("?")[0];if(S&&S.includes("/static/"))if(S.includes("http"))try{const X=new URL(S);a.add(X.pathname)}catch{a.add(S)}else a.add(S)}catch(S){console.warn("处理图片src时出错:",S)}}),console.log(`需要刷新 ${a.size} 个不同图标`);const l=5,z=Array.from(a),T=[];for(let h=0;h<z.length;h+=l){const S=z.slice(h,h+l);console.log(`刷新批次 ${Math.floor(h/l)+1}: ${S.length} 个图标`);const X=S.map(q=>{const he=`img[src*="${q.split("?")[0]}"]`,me=document.querySelectorAll(he);return me.length>0?Q(q,me[0]):Q(q)}),n=await Promise.all(X);T.push(...n),await new Promise(q=>setTimeout(q,300))}const M=T.filter(Boolean).length;return console.log(`刷新完成: ${M}/${a.size} 个图标成功刷新`),M>0?(v.success(`成功刷新 ${M} 个图标预览`),!0):(v.warning("没有成功刷新任何图标，请尝试手动刷新页面"),!1)}catch(a){return console.error("刷新所有图标预览失败:",a),v.error("刷新图标预览失败: "+(a.message||"未知错误")),!1}finally{oe.value=!1}},Ee=async a=>{try{v.info(`正在刷新图标: ${a}`);const e=`blob_url_${a}`;sessionStorage.getItem(e)&&(console.log(`清除图标缓存: ${e}`),sessionStorage.removeItem(e)),await Ce(a)?v.success("图标刷新成功"):v.warning("图标刷新失败，请检查图标是否存在")}catch(e){console.error("刷新图标失败:",e),v.error("刷新图标失败: "+e.message)}},Ce=async a=>{try{let e=a;e.startsWith("/")||(e="/"+e);const l="http://localhost:3000",z=Date.now(),T=Math.random().toString(36).substring(2,8),M=`${l}${e}?t=${z}&r=${T}`;console.log(`尝试从${l}导入图标: ${e}`);const h=await fetch(M,{method:"GET",cache:"no-cache",headers:{"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"}});if(!h.ok)return console.warn(`从${l}获取图标失败: ${h.status} ${h.statusText}`),!1;const S=await h.blob();if(!S.type.startsWith("image/"))return console.warn(`从${l}获取的数据不是图像: ${S.type}`),!1;const X=URL.createObjectURL(S),n=`blob_url_${e}`;sessionStorage.setItem(n,X);const q=`img[src*="${e.split("?")[0]}"], img[data-path="${e}"]`,Y=document.querySelectorAll(q);return console.log(`找到 ${Y.length} 个匹配的图像元素`),Y.forEach((he,me)=>{he.src=X,console.log(`更新图像 ${me+1}/${Y.length}`)}),!0}catch(e){return console.error(`导入图标失败: ${a}`,e),!1}};return(a,e)=>{const l=y("el-button"),z=y("el-input"),T=y("el-form-item"),M=y("el-option"),h=y("el-select"),S=y("el-form"),X=y("el-card"),n=y("el-radio-button"),q=y("el-radio-group"),Y=y("el-table-column"),he=y("el-icon"),me=y("el-tooltip"),je=y("el-tag"),Ne=y("el-table"),Oe=y("el-pagination"),Ge=y("el-empty"),Ve=y("el-upload"),_e=y("el-dialog"),Me=y("el-divider"),Pe=Ae("loading");return $(),G("div",Rt,[s("div",Dt,[e[17]||(e[17]=s("h2",null,"图标管理",-1)),s("div",At,[t(l,{type:"warning",icon:"Refresh",onClick:pe,loading:oe.value},{default:o(()=>e[15]||(e[15]=[i(" 强制刷新图标预览 ")])),_:1},8,["loading"]),t(l,{type:"primary",onClick:ye},{default:o(()=>e[16]||(e[16]=[i("上传新图标")])),_:1})])]),t(X,{shadow:"hover",class:"filter-card"},{default:o(()=>[t(S,{inline:!0,model:g,class:"filter-form"},{default:o(()=>[t(T,{label:"图标名称"},{default:o(()=>[t(z,{modelValue:g.name,"onUpdate:modelValue":e[0]||(e[0]=p=>g.name=p),placeholder:"搜索图标名称",clearable:""},null,8,["modelValue"])]),_:1}),t(T,{label:"图标类型"},{default:o(()=>[t(h,{modelValue:g.type,"onUpdate:modelValue":e[1]||(e[1]=p=>g.type=p),placeholder:"选择图标类型",clearable:""},{default:o(()=>[($(),G(ce,null,$e(m,p=>t(M,{key:p.value,label:p.label,value:p.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),t(T,{label:"使用状态"},{default:o(()=>[t(h,{modelValue:g.status,"onUpdate:modelValue":e[2]||(e[2]=p=>g.status=p),placeholder:"选择使用状态",clearable:""},{default:o(()=>[t(M,{label:"已使用",value:"used"}),t(M,{label:"未使用",value:"unused"})]),_:1},8,["modelValue"])]),_:1}),t(T,null,{default:o(()=>[t(l,{type:"primary",onClick:te},{default:o(()=>e[18]||(e[18]=[i("搜索")])),_:1}),t(l,{onClick:ke},{default:o(()=>e[19]||(e[19]=[i("重置")])),_:1}),t(l,{type:"success",onClick:ye},{default:o(()=>e[20]||(e[20]=[i("上传图标")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),s("div",Lt,[t(q,{modelValue:V.value,"onUpdate:modelValue":e[3]||(e[3]=p=>V.value=p),size:"large"},{default:o(()=>[t(n,{value:"icons"},{default:o(()=>e[21]||(e[21]=[i("图标库")])),_:1}),t(n,{value:"usage"},{default:o(()=>e[22]||(e[22]=[i("应用图标位置")])),_:1}),t(n,{value:"monitor"},{default:o(()=>e[23]||(e[23]=[i("图标监控")])),_:1})]),_:1},8,["modelValue"])]),V.value==="icons"?Te(($(),ee(X,{key:0,shadow:"hover",class:"icons-card"},{default:o(()=>[Te(($(),ee(Ne,{data:le.value,style:{width:"100%"}},{default:o(()=>[t(Y,{prop:"id",label:"ID",width:"80"}),t(Y,{label:"图标预览",width:"120"},{default:o(p=>[s("div",Ft,[s("img",{src:H(fe)(p.row.url),alt:p.row.name,"data-path":p.row.url,class:"icon-image"},null,8,Bt),p.row.url?N("",!0):($(),ee(me,{key:0,content:"图标不存在",placement:"top"},{default:o(()=>[t(he,{class:"icon-warning"},{default:o(()=>[t(H(et))]),_:1})]),_:1}))])]),_:1}),t(Y,{prop:"name",label:"图标名称"}),t(Y,{prop:"typeName",label:"图标类型"}),t(Y,{prop:"size",label:"文件大小",width:"100"}),t(Y,{prop:"createTime",label:"上传时间",width:"180"}),t(Y,{label:"使用状态",width:"100"},{default:o(p=>[t(je,{type:p.row.used?"success":"info"},{default:o(()=>[i(_(p.row.used?"已使用":"未使用"),1)]),_:2},1032,["type"])]),_:1}),t(Y,{label:"操作",width:"250"},{default:o(p=>[t(l,{size:"small",type:"primary",onClick:we=>de(p.row)},{default:o(()=>e[24]||(e[24]=[i("预览")])),_:2},1032,["onClick"]),t(l,{size:"small",type:"success",onClick:we=>Se(p.row)},{default:o(()=>e[25]||(e[25]=[i("替换")])),_:2},1032,["onClick"]),t(l,{size:"small",type:"danger",onClick:we=>se(p.row),disabled:p.row.used},{default:o(()=>e[26]||(e[26]=[i("删除")])),_:2},1032,["onClick","disabled"])]),_:1})]),_:1},8,["data"])),[[Pe,f.value]]),s("div",jt,[t(Oe,{background:"",layout:"total, sizes, prev, pager, next, jumper",total:B.value,"page-size":L.value,"current-page":u.value,onSizeChange:ne,onCurrentChange:ve},null,8,["total","page-size","current-page"])])]),_:1})),[[Pe,f.value]]):V.value==="usage"?($(),G("div",Nt,[s("div",Ot,[t(q,{modelValue:E.value,"onUpdate:modelValue":e[4]||(e[4]=p=>E.value=p),size:"small"},{default:o(()=>[t(n,{value:"all"},{default:o(()=>e[27]||(e[27]=[i("全部")])),_:1}),t(n,{value:"tab"},{default:o(()=>e[28]||(e[28]=[i("标签栏图标")])),_:1}),t(n,{value:"marker"},{default:o(()=>e[29]||(e[29]=[i("标记图标")])),_:1}),t(n,{value:"ui"},{default:o(()=>e[30]||(e[30]=[i("界面图标")])),_:1})]),_:1},8,["modelValue"]),t(l,{type:"primary",onClick:pe,loading:oe.value},{default:o(()=>e[31]||(e[31]=[s("i",{class:"el-icon-refresh"},null,-1),i(" 强制刷新预览 ")])),_:1},8,["loading"])]),s("div",Gt,[re.value.length===0?($(),ee(Ge,{key:0,description:"该类型下没有使用的图标"})):N("",!0),($(!0),G(ce,null,$e(re.value,(p,we)=>($(),ee(X,{key:we,class:"usage-icon-card",shadow:"hover"},{default:o(()=>[s("div",Wt,[s("div",Jt,[s("img",{src:H(fe)(p.path),alt:p.location,"data-path":p.path,class:"icon-image"},null,8,qt),p.path?N("",!0):($(),G("div",Ht))]),s("div",Kt,[s("h4",null,_(p.location),1),s("p",Qt,_(p.path),1),s("div",Xt,[t(l,{size:"small",type:"primary",onClick:We=>r(p)},{default:o(()=>e[32]||(e[32]=[i("替换此图标")])),_:2},1032,["onClick"]),t(l,{size:"small",type:"warning",onClick:We=>Ee(p.path)},{default:o(()=>e[33]||(e[33]=[i("刷新预览")])),_:2},1032,["onClick"])])])])]),_:2},1024))),128))])])):V.value==="monitor"?($(),G("div",Yt,[t(Pt)])):N("",!0),t(_e,{title:"上传图标",modelValue:W.value,"onUpdate:modelValue":e[9]||(e[9]=p=>W.value=p),width:"500px"},{footer:o(()=>[s("div",Zt,[t(l,{onClick:e[8]||(e[8]=p=>W.value=!1)},{default:o(()=>e[36]||(e[36]=[i("取消")])),_:1}),t(l,{type:"primary",onClick:A},{default:o(()=>e[37]||(e[37]=[i("上传")])),_:1})])]),default:o(()=>[t(S,{ref_key:"uploadFormRef",ref:F,model:c,rules:D,"label-width":"80px"},{default:o(()=>[t(T,{label:"图标名称",prop:"name"},{default:o(()=>[t(z,{modelValue:c.name,"onUpdate:modelValue":e[5]||(e[5]=p=>c.name=p),placeholder:"请输入图标名称"},null,8,["modelValue"])]),_:1}),t(T,{label:"图标类型",prop:"type"},{default:o(()=>[t(h,{modelValue:c.type,"onUpdate:modelValue":e[6]||(e[6]=p=>c.type=p),placeholder:"请选择图标类型"},{default:o(()=>[($(),G(ce,null,$e(m,p=>t(M,{key:p.value,label:p.label,value:p.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),t(T,{label:"图标描述"},{default:o(()=>[t(z,{modelValue:c.description,"onUpdate:modelValue":e[7]||(e[7]=p=>c.description=p),type:"textarea",placeholder:"请输入图标描述"},null,8,["modelValue"])]),_:1}),t(T,{label:"上传图标",prop:"file"},{default:o(()=>[t(Ve,{ref:"upload",action:"#","auto-upload":!1,"on-change":xe,"on-remove":ge,limit:1},{tip:o(()=>e[35]||(e[35]=[s("div",{class:"el-upload__tip"}," 请上传PNG、JPG、SVG格式的图片文件，大小不超过2MB ",-1)])),default:o(()=>[t(l,{type:"primary"},{default:o(()=>e[34]||(e[34]=[i("选择文件")])),_:1})]),_:1},512)]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),t(_e,{title:"替换图标",modelValue:k.value,"onUpdate:modelValue":e[11]||(e[11]=p=>k.value=p),width:"500px",class:"replace-dialog"},{footer:o(()=>[s("div",ao,[t(l,{onClick:e[10]||(e[10]=p=>k.value=!1)},{default:o(()=>e[42]||(e[42]=[i("取消")])),_:1}),t(l,{type:"primary",onClick:I,disabled:!Z.value},{default:o(()=>e[43]||(e[43]=[i("替换")])),_:1},8,["disabled"])])]),default:o(()=>[x.value?($(),G(ce,{key:0},[s("div",eo,[e[38]||(e[38]=s("h4",null,"当前图标",-1)),s("img",{src:H(fe)(x.value.url),alt:x.value.name,"data-path":x.value.url},null,8,to),s("p",null,_(x.value.name),1)]),t(Me),s("div",oo,[e[41]||(e[41]=s("h4",null,"上传新图标",-1)),t(Ve,{ref:"replaceUpload",action:"#","auto-upload":!1,"on-change":ie,"on-remove":d,limit:1},{tip:o(()=>e[40]||(e[40]=[s("div",{class:"el-upload__tip"}," 请上传PNG、JPG、SVG格式的图片文件，大小不超过2MB ",-1)])),default:o(()=>[t(l,{type:"primary"},{default:o(()=>e[39]||(e[39]=[i("选择文件")])),_:1})]),_:1},512)])],64)):N("",!0)]),_:1},8,["modelValue"]),t(_e,{title:"图标详情",modelValue:K.value,"onUpdate:modelValue":e[12]||(e[12]=p=>K.value=p),width:"400px",class:"icon-preview-dialog"},{default:o(()=>[x.value?($(),G(ce,{key:0},[s("div",lo,[s("img",{src:H(fe)(x.value.url),alt:x.value.name,"data-path":x.value.url},null,8,so)]),s("div",no,[s("p",null,[e[44]||(e[44]=s("strong",null,"名称:",-1)),i(" "+_(x.value.name),1)]),s("p",null,[e[45]||(e[45]=s("strong",null,"类型:",-1)),i(" "+_(x.value.typeName),1)]),s("p",null,[e[46]||(e[46]=s("strong",null,"描述:",-1)),i(" "+_(x.value.description||"无"),1)]),s("p",null,[e[47]||(e[47]=s("strong",null,"大小:",-1)),i(" "+_(x.value.size),1)]),s("p",null,[e[48]||(e[48]=s("strong",null,"上传时间:",-1)),i(" "+_(x.value.createTime),1)]),s("p",null,[e[49]||(e[49]=s("strong",null,"使用状态:",-1)),i(" "+_(x.value.used?"已使用":"未使用"),1)]),x.value.used?($(),G("p",ro,[e[50]||(e[50]=s("strong",null,"使用位置:",-1)),i(" "+_(x.value.usedLocation||"未指定"),1)])):N("",!0)])],64)):N("",!0)]),_:1},8,["modelValue"]),t(_e,{title:"替换应用图标",modelValue:C.value,"onUpdate:modelValue":e[14]||(e[14]=p=>C.value=p),width:"500px"},{footer:o(()=>[s("div",po,[t(l,{onClick:e[13]||(e[13]=p=>C.value=!1)},{default:o(()=>e[54]||(e[54]=[i("取消")])),_:1}),t(l,{type:"primary",onClick:O,disabled:!J.value},{default:o(()=>e[55]||(e[55]=[i("替换")])),_:1},8,["disabled"])])]),default:o(()=>[U.value?($(),G(ce,{key:0},[s("div",io,[s("h4",null,"当前图标 - "+_(U.value.location),1),s("img",{src:H(fe)(U.value.path),alt:U.value.location,"data-path":U.value.path},null,8,co),s("p",null,_(U.value.path),1)]),t(Me),s("div",uo,[e[53]||(e[53]=s("h4",null,"上传新图标",-1)),t(Ve,{ref:"appIconUpload",action:"#","auto-upload":!1,"on-change":R,"on-remove":j,limit:1},{tip:o(()=>e[52]||(e[52]=[s("div",{class:"el-upload__tip"}," 请上传PNG、JPG、SVG格式的图片文件，大小不超过2MB。建议保持与原图标尺寸一致。 ",-1)])),default:o(()=>[t(l,{type:"primary"},{default:o(()=>e[51]||(e[51]=[i("选择文件")])),_:1})]),_:1},512)])],64)):N("",!0)]),_:1},8,["modelValue"])])}}},yo=Fe(mo,[["__scopeId","data-v-57bcde8e"]]);export{yo as default};
