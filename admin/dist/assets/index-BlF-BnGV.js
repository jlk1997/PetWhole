import{r as b,v as H,A as J,B as X,C as Y,b as j,d as a,e as s,w as o,g as m,s as O,D as q,o as z,k as D,y as K,t as v,G as Q,H as Z,I as tt,p as k,J as et,i as st}from"./index-BZUGXbIj.js";import{g as T}from"./index-DMQPIv9t.js";import{_ as at}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{u as ot,i as $,L as nt,a as rt,b as lt,c as it,d as ut,e as dt,f as ct,g as mt,h as pt}from"./installCanvasRenderer-ckwQY7it.js";import"./index-xsH4HHeE.js";const ht={class:"dashboard-container"},ft={class:"stat-icon user-icon"},_t={class:"stat-content"},vt={class:"stat-value"},wt={class:"stat-footer"},Ct={class:"stat-icon pet-icon"},gt={class:"stat-content"},bt={class:"stat-value"},yt={class:"stat-footer"},Dt={class:"stat-icon post-icon"},kt={class:"stat-content"},At={class:"stat-value"},Et={class:"stat-footer"},Mt={class:"stat-icon marker-icon"},xt={class:"stat-content"},Pt={class:"stat-value"},Rt={class:"stat-footer"},Lt={class:"chart-header"},St={class:"recent-header"},Ot={__name:"index",setup(zt){ot([rt,lt,it,ut,dt,ct,mt,pt]);const A=b(null),E=b(null);let p=null,h=null;const M=b(!1),g=b("week"),n=H({userCount:0,newUserCount:0,petCount:0,newPetCount:0,postCount:0,newPostCount:0,markerCount:0,newMarkerCount:0}),w=b(null),x=b([]),U=async()=>{M.value=!0;try{const e=await T("/admin/dashboard/stats");if(!e||!e.data)throw new Error("无效的数据响应");w.value=e.data;const t=e.data.users||{},l=e.data.pets||{},i=e.data.posts||{},r=e.data.markers||{};n.userCount=t.total||0,n.newUserCount=t.new||0,n.petCount=l.total||0,n.newPetCount=l.new||0,n.postCount=i.total||0,n.newPostCount=i.new||0,n.markerCount=r.total||0,n.newMarkerCount=r.new||0,y(g.value),R(e.data)}catch(e){console.error("获取仪表盘数据失败:",e),O.error("获取仪表盘数据失败，显示模拟数据"),F(),y(g.value),R(null)}finally{M.value=!1}},I=async()=>{try{const e=await T("/admin/system/logs",{limit:5});e&&e.data&&Array.isArray(e.data)?e.data.length>0?x.value=e.data.map(t=>{var l,i,r;return{time:t.createdAt?new Date(t.createdAt).toLocaleString():"未知时间",user:((l=t.user)==null?void 0:l.nickname)||((i=t.user)==null?void 0:i.name)||((r=t.user)==null?void 0:r.username)||"系统",action:t.description||W(t.action)||"未知操作",ip:t.ip||"-",id:t._id||Date.now()+Math.random().toString(36).substring(2,10)}}):(console.warn("系统日志为空"),P()):(console.warn("获取系统日志返回数据格式不正确",e),P())}catch(e){console.error("获取最近活动失败:",e),P()}},W=e=>e?{LOGIN:"登录系统",LOGOUT:"退出系统",CREATE:"创建内容",UPDATE:"更新内容",DELETE:"删除内容",REVIEW:"审核内容",UPLOAD:"上传文件",DOWNLOAD:"下载文件",EXPORT:"导出数据",IMPORT:"导入数据",UPDATE_SETTINGS:"更新设置",SYSTEM_ERROR:"系统错误",API_ERROR:"API错误",OTHER:"其他操作"}[e]||e:"未知操作",P=()=>{x.value=[{time:"2023-11-20 15:32:18",user:"张三",action:"发布了一篇新帖子",ip:"192.168.1.1"},{time:"2023-11-20 14:18:05",user:"李四",action:"添加了一个新标记",ip:"192.168.1.2"},{time:"2023-11-20 12:45:30",user:"王五",action:"评论了一篇帖子",ip:"192.168.1.3"},{time:"2023-11-20 11:22:47",user:"赵六",action:"上传了宠物照片",ip:"192.168.1.4"},{time:"2023-11-20 10:05:16",user:"孙七",action:"更新了个人信息",ip:"192.168.1.5"}]},F=()=>{n.userCount=1286,n.newUserCount=32,n.petCount=968,n.newPetCount=15,n.postCount=2345,n.newPostCount=78,n.markerCount=532,n.newMarkerCount=23};J(()=>{U(),I(),V(),B(),window.addEventListener("resize",S)}),X(()=>{window.removeEventListener("resize",S),p&&(p.dispose(),p=null),h&&(h.dispose(),h=null)}),Y(g,e=>{y(e)});const V=()=>{A.value&&(p=$(A.value),y(g.value))},y=e=>{var r,f,_,C;if(!p)return;let t=[],l=[];if(e==="week"&&((f=(r=w.value)==null?void 0:r.users)!=null&&f.growthWeek)&&Array.isArray(w.value.users.growthWeek)){const d=w.value.users.growthWeek;t=d.map(u=>u.date||"未知"),l=d.map(u=>u.count||0)}else if(e==="month"&&((C=(_=w.value)==null?void 0:_.users)!=null&&C.growthMonth)&&Array.isArray(w.value.users.growthMonth)){const d=w.value.users.growthMonth;t=d.map(u=>u.date||"未知"),l=d.map(u=>u.count||0)}else e==="week"?(t=Array.from({length:7},(d,u)=>{const c=new Date;return c.setDate(c.getDate()-6+u),`${c.getMonth()+1}/${c.getDate()}`}),l=Array.from({length:7},()=>Math.floor(Math.random()*5))):(t=Array.from({length:30},(d,u)=>{const c=new Date;return c.setDate(c.getDate()-29+u),`${c.getMonth()+1}/${c.getDate()}`}),l=Array.from({length:30},()=>Math.floor(Math.random()*5)));const i={tooltip:{trigger:"axis"},grid:{top:20,left:50,right:20,bottom:40},xAxis:{type:"category",data:t,axisTick:{alignWithLabel:!0},axisLabel:{rotate:e==="month"?45:0,fontSize:10,interval:e==="month"?"auto":0}},yAxis:{type:"value",minInterval:1,splitLine:{lineStyle:{type:"dashed"}}},series:[{name:"新增用户",type:"line",data:l,smooth:!0,symbol:"circle",symbolSize:6,lineStyle:{width:3,color:"#409EFF"},itemStyle:{color:"#409EFF"},areaStyle:{color:new nt(0,0,0,1,[{offset:0,color:"rgba(64,158,255,0.6)"},{offset:1,color:"rgba(64,158,255,0.1)"}])}}]};p.setOption(i)},B=()=>{E.value&&(h=$(E.value),R())},R=e=>{var r,f,_,C;if(!h)return;const t=[{name:"用户",value:((r=e==null?void 0:e.users)==null?void 0:r.total)||n.userCount||0},{name:"宠物",value:((f=e==null?void 0:e.pets)==null?void 0:f.total)||n.petCount||0},{name:"帖子",value:((_=e==null?void 0:e.posts)==null?void 0:_.total)||n.postCount||0},{name:"地图标记",value:((C=e==null?void 0:e.markers)==null?void 0:C.total)||n.markerCount||0}];t.some(d=>d.value>0)||(t[0].value=120,t[1].value=80,t[2].value=150,t[3].value=40);const i={tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} ({d}%)"},legend:{orient:"horizontal",bottom:10,left:"center",itemWidth:16,itemHeight:10,data:t.map(d=>d.name)},series:[{name:"内容分布",type:"pie",radius:["35%","65%"],center:["50%","45%"],avoidLabelOverlap:!0,itemStyle:{borderRadius:8,borderColor:"#fff",borderWidth:2},label:{show:!0,formatter:"{b}: {c}",fontSize:12,position:"outside"},emphasis:{label:{show:!0,fontSize:14,fontWeight:"bold"}},labelLine:{show:!0,length:15,length2:10},data:t,color:["#409EFF","#67C23A","#E6A23C","#F56C6C"]}]};h.setOption(i)},S=()=>{p&&p.resize(),h&&h.resize()},N=e=>{O.info(`查看活动: ${e.action}`)};return(e,t)=>{const l=m("el-icon"),i=m("el-card"),r=m("el-col"),f=m("el-row"),_=m("el-radio-button"),C=m("el-radio-group"),d=m("el-button"),u=m("el-table-column"),c=m("el-table"),G=q("loading");return z(),j("div",ht,[t[12]||(t[12]=a("div",{class:"page-header"},[a("h2",null,"系统概览")],-1)),s(f,{gutter:20},{default:o(()=>[s(r,{xs:24,sm:12,md:6},{default:o(()=>[s(i,{shadow:"hover",class:"stat-card"},{default:o(()=>[a("div",ft,[s(l,null,{default:o(()=>[s(D(K))]),_:1})]),a("div",_t,[t[1]||(t[1]=a("div",{class:"stat-title"},"用户总数",-1)),a("div",vt,v(n.userCount),1),a("div",wt,"今日新增: +"+v(n.newUserCount),1)])]),_:1})]),_:1}),s(r,{xs:24,sm:12,md:6},{default:o(()=>[s(i,{shadow:"hover",class:"stat-card"},{default:o(()=>[a("div",Ct,[s(l,null,{default:o(()=>[s(D(Q))]),_:1})]),a("div",gt,[t[2]||(t[2]=a("div",{class:"stat-title"},"宠物总数",-1)),a("div",bt,v(n.petCount),1),a("div",yt,"今日新增: +"+v(n.newPetCount),1)])]),_:1})]),_:1}),s(r,{xs:24,sm:12,md:6},{default:o(()=>[s(i,{shadow:"hover",class:"stat-card"},{default:o(()=>[a("div",Dt,[s(l,null,{default:o(()=>[s(D(Z))]),_:1})]),a("div",kt,[t[3]||(t[3]=a("div",{class:"stat-title"},"帖子总数",-1)),a("div",At,v(n.postCount),1),a("div",Et,"今日新增: +"+v(n.newPostCount),1)])]),_:1})]),_:1}),s(r,{xs:24,sm:12,md:6},{default:o(()=>[s(i,{shadow:"hover",class:"stat-card"},{default:o(()=>[a("div",Mt,[s(l,null,{default:o(()=>[s(D(tt))]),_:1})]),a("div",xt,[t[4]||(t[4]=a("div",{class:"stat-title"},"标记总数",-1)),a("div",Pt,v(n.markerCount),1),a("div",Rt,"今日新增: +"+v(n.newMarkerCount),1)])]),_:1})]),_:1})]),_:1}),s(f,{gutter:20,class:"dashboard-charts"},{default:o(()=>[s(r,{xs:24,md:12},{default:o(()=>[s(i,{shadow:"hover",class:"chart-card"},{header:o(()=>[a("div",Lt,[t[7]||(t[7]=a("span",null,"用户增长趋势",-1)),s(C,{modelValue:g.value,"onUpdate:modelValue":t[0]||(t[0]=L=>g.value=L),size:"small"},{default:o(()=>[s(_,{value:"week"},{default:o(()=>t[5]||(t[5]=[k("近7天")])),_:1}),s(_,{value:"month"},{default:o(()=>t[6]||(t[6]=[k("近30天")])),_:1})]),_:1},8,["modelValue"])])]),default:o(()=>[a("div",{class:"chart-container",ref_key:"userChartRef",ref:A},null,512)]),_:1})]),_:1}),s(r,{xs:24,md:12},{default:o(()=>[s(i,{shadow:"hover",class:"chart-card"},{header:o(()=>t[8]||(t[8]=[a("div",{class:"chart-header"},[a("span",null,"内容分布")],-1)])),default:o(()=>[a("div",{class:"chart-container",ref_key:"pieChartRef",ref:E},null,512)]),_:1})]),_:1})]),_:1}),s(i,{shadow:"hover",class:"dashboard-recent"},{header:o(()=>[a("div",St,[t[10]||(t[10]=a("span",null,"最新活动",-1)),s(d,{type:"primary",size:"small",plain:""},{default:o(()=>t[9]||(t[9]=[k("查看更多")])),_:1})])]),default:o(()=>[et((z(),st(c,{data:x.value,style:{width:"100%"}},{default:o(()=>[s(u,{prop:"time",label:"时间",width:"180"}),s(u,{prop:"user",label:"用户",width:"120"}),s(u,{prop:"action",label:"操作"}),s(u,{prop:"ip",label:"IP地址",width:"140"}),s(u,{label:"操作",width:"100"},{default:o(L=>[s(d,{size:"small",onClick:Tt=>N(L.row)},{default:o(()=>t[11]||(t[11]=[k("查看")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[G,M.value]])]),_:1})])}}},Vt=at(Ot,[["__scopeId","data-v-5f1efabf"]]);export{Vt as default};
