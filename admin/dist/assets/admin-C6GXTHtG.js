import{g as Z,a as q,d as h,p as ee}from"./index-DMQPIv9t.js";import{_ as ae}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{c as T,r as _,v as E,A as te,b as le,d as k,e as r,w as o,g as m,s as p,D as re,o as d,p as i,J as oe,i as u,t as C,f as z,E as L}from"./index-BZUGXbIj.js";import"./index-xsH4HHeE.js";const ne={class:"admin-list-container"},se={class:"page-header"},ie={class:"pagination-container"},de={class:"dialog-footer"},ue={__name:"admin",setup(me){const U=T(()=>{const l=localStorage.getItem("user");return l?JSON.parse(l):{}}),x=T(()=>U.value.role==="superadmin"),$=_(!1),B=_([]),D=_(0),f=E({page:1,limit:10}),v=_(!1),c=_("add"),P=_(null),t=E({username:"",name:"",email:"",role:"editor",password:"",confirmPassword:""}),N={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"长度在 3 到 20 个字符",trigger:"blur"}],name:[{required:!0,message:"请输入姓名",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}],role:[{required:!0,message:"请选择角色",trigger:"change"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码长度不能小于6位",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认密码",trigger:"blur"},{validator:(l,e,n)=>{e!==t.password?n(new Error("两次输入密码不一致")):n()},trigger:"blur"}]},A=l=>l?new Date(l).toLocaleString():"-",w=async()=>{var l;$.value=!0;try{const e=await Z("/api/admin/admins",f);B.value=e.data||[],D.value=((l=e.pagination)==null?void 0:l.total)||0}catch(e){console.error("获取管理员列表失败:",e),p.error("获取管理员列表失败")}finally{$.value=!1}},M=()=>{c.value="add",t.username="",t.name="",t.email="",t.role="editor",t.password="",t.confirmPassword="",v.value=!0},I=l=>{c.value="edit",t.id=l._id,t.username=l.username,t.name=l.name,t.email=l.email,t.role=l.role,t.password="",t.confirmPassword="",v.value=!0},J=async l=>{const e=l.status==="active"?"禁用":"启用";L.confirm(`确定要${e}管理员 ${l.username} 吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const n=l.status==="active"?"inactive":"active";await q(`/api/admin/admins/${l._id}/status`,{status:n}),p.success(`${e}成功`),w()}catch(n){console.error(`${e}管理员失败:`,n),p.error(`${e}失败`)}}).catch(()=>{p.info("已取消操作")})},R=l=>{if(l._id===U.value.id){p.warning("不能删除自己的账号");return}L.confirm(`确定要删除管理员 ${l.username} 吗？此操作不可逆`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await h(`/api/admin/admins/${l._id}`),p.success("删除成功"),w()}catch(e){console.error("删除管理员失败:",e),p.error("删除失败")}}).catch(()=>{p.info("已取消删除")})},j=async()=>{P.value&&P.value.validate(async l=>{var e,n;if(l)try{if(c.value==="add"){const s={username:t.username,name:t.name,email:t.email,role:t.role,password:t.password};await ee("/api/admin/admins",s),p.success("添加管理员成功")}else{const s={name:t.name,email:t.email,role:t.role};await q(`/api/admin/admins/${t.id}`,s),p.success("更新管理员信息成功")}v.value=!1,w()}catch(s){console.error("提交管理员信息失败:",s),p.error("操作失败: "+(((n=(e=s.response)==null?void 0:e.data)==null?void 0:n.message)||s.message))}})},F=l=>{f.limit=l,w()},O=l=>{f.page=l,w()};return te(()=>{w()}),(l,e)=>{const n=m("el-button"),s=m("el-table-column"),g=m("el-tag"),G=m("el-table"),H=m("el-pagination"),K=m("el-card"),b=m("el-input"),y=m("el-form-item"),V=m("el-option"),Q=m("el-select"),W=m("el-form"),X=m("el-dialog"),Y=re("loading");return d(),le("div",ne,[k("div",se,[e[11]||(e[11]=k("h2",null,"管理员列表",-1)),r(n,{type:"primary",onClick:M},{default:o(()=>e[10]||(e[10]=[i("添加管理员")])),_:1})]),r(K,{class:"table-card"},{default:o(()=>[oe((d(),u(G,{data:B.value,style:{width:"100%"},border:""},{default:o(()=>[r(s,{type:"index",width:"50",align:"center"}),r(s,{prop:"username",label:"用户名",width:"150"}),r(s,{prop:"name",label:"姓名",width:"150"}),r(s,{prop:"email",label:"邮箱",width:"220"}),r(s,{prop:"role",label:"角色",width:"120"},{default:o(a=>[a.row.role==="admin"?(d(),u(g,{key:0,type:"success"},{default:o(()=>e[12]||(e[12]=[i("管理员")])),_:1})):a.row.role==="superadmin"?(d(),u(g,{key:1,type:"danger"},{default:o(()=>e[13]||(e[13]=[i("超级管理员")])),_:1})):a.row.role==="editor"?(d(),u(g,{key:2,type:"warning"},{default:o(()=>e[14]||(e[14]=[i("编辑")])),_:1})):a.row.role==="viewer"?(d(),u(g,{key:3,type:"info"},{default:o(()=>e[15]||(e[15]=[i("访客")])),_:1})):(d(),u(g,{key:4},{default:o(()=>[i(C(a.row.role),1)]),_:2},1024))]),_:1}),r(s,{prop:"status",label:"状态",width:"100"},{default:o(a=>[a.row.status==="active"?(d(),u(g,{key:0,type:"success"},{default:o(()=>e[16]||(e[16]=[i("正常")])),_:1})):a.row.status==="inactive"?(d(),u(g,{key:1,type:"info"},{default:o(()=>e[17]||(e[17]=[i("未激活")])),_:1})):a.row.status==="locked"?(d(),u(g,{key:2,type:"danger"},{default:o(()=>e[18]||(e[18]=[i("已锁定")])),_:1})):(d(),u(g,{key:3},{default:o(()=>[i(C(a.row.status),1)]),_:2},1024))]),_:1}),r(s,{prop:"lastLogin",label:"最后登录时间",width:"180"},{default:o(a=>[i(C(A(a.row.lastLogin)),1)]),_:1}),r(s,{label:"操作",align:"center"},{default:o(a=>[r(n,{size:"small",type:"primary",onClick:S=>I(a.row),disabled:a.row.role==="superadmin"&&!x.value},{default:o(()=>e[19]||(e[19]=[i(" 编辑 ")])),_:2},1032,["onClick","disabled"]),r(n,{size:"small",type:a.row.status==="active"?"warning":"success",onClick:S=>J(a.row),disabled:a.row.role==="superadmin"&&!x.value},{default:o(()=>[i(C(a.row.status==="active"?"禁用":"启用"),1)]),_:2},1032,["type","onClick","disabled"]),r(n,{size:"small",type:"danger",onClick:S=>R(a.row),disabled:a.row.role==="superadmin"},{default:o(()=>e[20]||(e[20]=[i(" 删除 ")])),_:2},1032,["onClick","disabled"])]),_:1})]),_:1},8,["data"])),[[Y,$.value]]),k("div",ie,[r(H,{currentPage:f.page,"onUpdate:currentPage":e[0]||(e[0]=a=>f.page=a),"page-size":f.limit,"onUpdate:pageSize":e[1]||(e[1]=a=>f.limit=a),"page-sizes":[10,20,50,100],total:D.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:F,onCurrentChange:O},null,8,["currentPage","page-size","total"])])]),_:1}),r(X,{modelValue:v.value,"onUpdate:modelValue":e[9]||(e[9]=a=>v.value=a),title:c.value==="add"?"添加管理员":"编辑管理员",width:"500px"},{footer:o(()=>[k("span",de,[r(n,{onClick:e[8]||(e[8]=a=>v.value=!1)},{default:o(()=>e[21]||(e[21]=[i("取消")])),_:1}),r(n,{type:"primary",onClick:j},{default:o(()=>e[22]||(e[22]=[i("确认")])),_:1})])]),default:o(()=>[r(W,{ref_key:"formRef",ref:P,model:t,rules:N,"label-width":"100px"},{default:o(()=>[r(y,{label:"用户名",prop:"username"},{default:o(()=>[r(b,{modelValue:t.username,"onUpdate:modelValue":e[2]||(e[2]=a=>t.username=a),disabled:c.value==="edit"},null,8,["modelValue","disabled"])]),_:1}),r(y,{label:"姓名",prop:"name"},{default:o(()=>[r(b,{modelValue:t.name,"onUpdate:modelValue":e[3]||(e[3]=a=>t.name=a)},null,8,["modelValue"])]),_:1}),r(y,{label:"邮箱",prop:"email"},{default:o(()=>[r(b,{modelValue:t.email,"onUpdate:modelValue":e[4]||(e[4]=a=>t.email=a)},null,8,["modelValue"])]),_:1}),r(y,{label:"角色",prop:"role"},{default:o(()=>[r(Q,{modelValue:t.role,"onUpdate:modelValue":e[5]||(e[5]=a=>t.role=a),placeholder:"请选择角色"},{default:o(()=>[r(V,{label:"管理员",value:"admin"}),r(V,{label:"编辑",value:"editor"}),r(V,{label:"访客",value:"viewer"}),x.value?(d(),u(V,{key:0,label:"超级管理员",value:"superadmin"})):z("",!0)]),_:1},8,["modelValue"])]),_:1}),c.value==="add"?(d(),u(y,{key:0,label:"密码",prop:"password"},{default:o(()=>[r(b,{modelValue:t.password,"onUpdate:modelValue":e[6]||(e[6]=a=>t.password=a),type:"password"},null,8,["modelValue"])]),_:1})):z("",!0),c.value==="add"?(d(),u(y,{key:1,label:"确认密码",prop:"confirmPassword"},{default:o(()=>[r(b,{modelValue:t.confirmPassword,"onUpdate:modelValue":e[7]||(e[7]=a=>t.confirmPassword=a),type:"password"},null,8,["modelValue"])]),_:1})):z("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},ve=ae(ue,[["__scopeId","data-v-7c12e099"]]);export{ve as default};
