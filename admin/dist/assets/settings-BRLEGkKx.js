import{r as x,v as R,A as J,b as N,d as y,e as a,w as s,g as u,s as p,o as w,i as I,k as K,V as O,p as k,f as Q}from"./index-BZUGXbIj.js";import{g as X,p as L}from"./index-DMQPIv9t.js";import{_ as Y}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-xsH4HHeE.js";const Z={class:"settings-container"},h=["src"],ee={__name:"settings",setup(ae){const C=x("basic"),T={Authorization:`Bearer ${localStorage.getItem("token")}`},F=x(null),o=R({siteName:"",siteDescription:"",icpInfo:"",announcement:"",contactEmail:"",logo:""}),q={siteName:[{required:!0,message:"请输入系统名称",trigger:"blur"}],contactEmail:[{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}]},W=x(null),n=R({allowRegister:!0,requireEmailVerification:!1,defaultCredits:0,postLimitPerDay:0,maxPetsPerUser:0}),B={defaultCredits:[{type:"number",message:"积分必须为数字",trigger:"change"}],postLimitPerDay:[{type:"number",message:"发帖上限必须为数字",trigger:"change"}],maxPetsPerUser:[{type:"number",message:"宠物数量必须为数字",trigger:"change"}]},E=x(null),d=R({itemsPerPage:20,cacheTime:10,enableSensitiveWordFilter:!1,sensitiveWords:""}),M={itemsPerPage:[{required:!0,message:"请输入每页显示记录数",trigger:"blur"},{type:"number",message:"记录数必须为数字",trigger:"change"}],cacheTime:[{type:"number",message:"缓存时间必须为数字",trigger:"change"}]},A=async()=>{var m,e,r,t,c,_,g,b,V,v,f,P,U,l,D,S;try{const i=await X("/api/admin/system/settings");o.siteName=((m=i.data.basic)==null?void 0:m.siteName)||"",o.siteDescription=((e=i.data.basic)==null?void 0:e.siteDescription)||"",o.icpInfo=((r=i.data.basic)==null?void 0:r.icpInfo)||"",o.announcement=((t=i.data.basic)==null?void 0:t.announcement)||"",o.contactEmail=((c=i.data.basic)==null?void 0:c.contactEmail)||"",o.logo=((_=i.data.basic)==null?void 0:_.logo)||"",n.allowRegister=((g=i.data.user)==null?void 0:g.allowRegister)!==!1,n.requireEmailVerification=!!((b=i.data.user)!=null&&b.requireEmailVerification),n.defaultCredits=((V=i.data.user)==null?void 0:V.defaultCredits)||0,n.postLimitPerDay=((v=i.data.user)==null?void 0:v.postLimitPerDay)||0,n.maxPetsPerUser=((f=i.data.user)==null?void 0:f.maxPetsPerUser)||0,d.itemsPerPage=((P=i.data.advanced)==null?void 0:P.itemsPerPage)||20,d.cacheTime=((U=i.data.advanced)==null?void 0:U.cacheTime)||10,d.enableSensitiveWordFilter=!!((l=i.data.advanced)!=null&&l.enableSensitiveWordFilter),d.sensitiveWords=((S=(D=i.data.advanced)==null?void 0:D.sensitiveWords)==null?void 0:S.join(", "))||""}catch(i){console.error("加载系统设置失败:",i),p.error("加载系统设置失败")}},z=m=>{o.logo=m.data.url,p.success("Logo上传成功")},j=m=>{const e=m.type.startsWith("image/"),r=m.size/1024/1024<2;return e||p.error("Logo只能是图片格式!"),r||p.error("Logo大小不能超过2MB!"),e&&r},H=async()=>{F.value&&F.value.validate(async m=>{var e,r;if(m)try{await L("/api/admin/system/settings/basic",o),p.success("基础设置保存成功")}catch(t){console.error("保存基础设置失败:",t),p.error("保存失败: "+(((r=(e=t.response)==null?void 0:e.data)==null?void 0:r.message)||t.message))}})},$=async()=>{W.value&&W.value.validate(async m=>{var e,r;if(m)try{await L("/api/admin/system/settings/user",n),p.success("用户设置保存成功")}catch(t){console.error("保存用户设置失败:",t),p.error("保存失败: "+(((r=(e=t.response)==null?void 0:e.data)==null?void 0:r.message)||t.message))}})},G=async()=>{E.value&&E.value.validate(async m=>{var e,r;if(m)try{const t=d.sensitiveWords.split(",").map(c=>c.trim()).filter(c=>c);await L("/api/admin/system/settings/advanced",{...d,sensitiveWords:t}),p.success("高级设置保存成功")}catch(t){console.error("保存高级设置失败:",t),p.error("保存失败: "+(((r=(e=t.response)==null?void 0:e.data)==null?void 0:r.message)||t.message))}})};return J(()=>{A()}),(m,e)=>{const r=u("el-input"),t=u("el-form-item"),c=u("el-icon"),_=u("el-upload"),g=u("el-button"),b=u("el-form"),V=u("el-tab-pane"),v=u("el-switch"),f=u("el-input-number"),P=u("el-tabs"),U=u("el-card");return w(),N("div",Z,[e[21]||(e[21]=y("div",{class:"page-header"},[y("h2",null,"系统设置")],-1)),a(U,{class:"settings-card"},{default:s(()=>[a(P,{modelValue:C.value,"onUpdate:modelValue":e[14]||(e[14]=l=>C.value=l)},{default:s(()=>[a(V,{label:"基础设置",name:"basic"},{default:s(()=>[a(b,{ref_key:"basicFormRef",ref:F,model:o,rules:q,"label-width":"120px","status-icon":""},{default:s(()=>[a(t,{label:"系统名称",prop:"siteName"},{default:s(()=>[a(r,{modelValue:o.siteName,"onUpdate:modelValue":e[0]||(e[0]=l=>o.siteName=l)},null,8,["modelValue"])]),_:1}),a(t,{label:"系统描述",prop:"siteDescription"},{default:s(()=>[a(r,{modelValue:o.siteDescription,"onUpdate:modelValue":e[1]||(e[1]=l=>o.siteDescription=l),type:"textarea",rows:3},null,8,["modelValue"])]),_:1}),a(t,{label:"备案信息",prop:"icpInfo"},{default:s(()=>[a(r,{modelValue:o.icpInfo,"onUpdate:modelValue":e[2]||(e[2]=l=>o.icpInfo=l)},null,8,["modelValue"])]),_:1}),a(t,{label:"系统公告",prop:"announcement"},{default:s(()=>[a(r,{modelValue:o.announcement,"onUpdate:modelValue":e[3]||(e[3]=l=>o.announcement=l),type:"textarea",rows:4},null,8,["modelValue"])]),_:1}),a(t,{label:"联系邮箱",prop:"contactEmail"},{default:s(()=>[a(r,{modelValue:o.contactEmail,"onUpdate:modelValue":e[4]||(e[4]=l=>o.contactEmail=l)},null,8,["modelValue"])]),_:1}),a(t,{label:"Logo"},{default:s(()=>[a(_,{class:"avatar-uploader",action:"/api/admin/uploads",headers:T,"show-file-list":!1,"on-success":z,"before-upload":j},{default:s(()=>[o.logo?(w(),N("img",{key:0,src:o.logo,class:"avatar"},null,8,h)):(w(),I(c,{key:1,class:"avatar-uploader-icon"},{default:s(()=>[a(K(O))]),_:1}))]),_:1})]),_:1}),a(t,null,{default:s(()=>[a(g,{type:"primary",onClick:H},{default:s(()=>e[15]||(e[15]=[k("保存设置")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),a(V,{label:"用户设置",name:"user"},{default:s(()=>[a(b,{ref_key:"userFormRef",ref:W,model:n,rules:B,"label-width":"200px","status-icon":""},{default:s(()=>[a(t,{label:"开放注册",prop:"allowRegister"},{default:s(()=>[a(v,{modelValue:n.allowRegister,"onUpdate:modelValue":e[5]||(e[5]=l=>n.allowRegister=l)},null,8,["modelValue"])]),_:1}),a(t,{label:"需要邮箱验证",prop:"requireEmailVerification"},{default:s(()=>[a(v,{modelValue:n.requireEmailVerification,"onUpdate:modelValue":e[6]||(e[6]=l=>n.requireEmailVerification=l)},null,8,["modelValue"])]),_:1}),a(t,{label:"新用户默认积分",prop:"defaultCredits"},{default:s(()=>[a(f,{modelValue:n.defaultCredits,"onUpdate:modelValue":e[7]||(e[7]=l=>n.defaultCredits=l),min:0,precision:0},null,8,["modelValue"])]),_:1}),a(t,{label:"日发帖上限",prop:"postLimitPerDay"},{default:s(()=>[a(f,{modelValue:n.postLimitPerDay,"onUpdate:modelValue":e[8]||(e[8]=l=>n.postLimitPerDay=l),min:0,precision:0},null,8,["modelValue"]),e[16]||(e[16]=y("span",{class:"form-help-text"},"设置为0表示不限制",-1))]),_:1}),a(t,{label:"最大宠物注册数量",prop:"maxPetsPerUser"},{default:s(()=>[a(f,{modelValue:n.maxPetsPerUser,"onUpdate:modelValue":e[9]||(e[9]=l=>n.maxPetsPerUser=l),min:0,precision:0},null,8,["modelValue"]),e[17]||(e[17]=y("span",{class:"form-help-text"},"设置为0表示不限制",-1))]),_:1}),a(t,null,{default:s(()=>[a(g,{type:"primary",onClick:$},{default:s(()=>e[18]||(e[18]=[k("保存设置")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),a(V,{label:"高级设置",name:"advanced"},{default:s(()=>[a(b,{ref_key:"advancedFormRef",ref:E,model:d,rules:M,"label-width":"200px","status-icon":""},{default:s(()=>[a(t,{label:"每页显示记录数",prop:"itemsPerPage"},{default:s(()=>[a(f,{modelValue:d.itemsPerPage,"onUpdate:modelValue":e[10]||(e[10]=l=>d.itemsPerPage=l),min:5,max:100,precision:0},null,8,["modelValue"])]),_:1}),a(t,{label:"系统缓存时间(分钟)",prop:"cacheTime"},{default:s(()=>[a(f,{modelValue:d.cacheTime,"onUpdate:modelValue":e[11]||(e[11]=l=>d.cacheTime=l),min:0,precision:0},null,8,["modelValue"]),e[19]||(e[19]=y("span",{class:"form-help-text"},"设置为0表示不缓存",-1))]),_:1}),a(t,{label:"敏感词过滤",prop:"enableSensitiveWordFilter"},{default:s(()=>[a(v,{modelValue:d.enableSensitiveWordFilter,"onUpdate:modelValue":e[12]||(e[12]=l=>d.enableSensitiveWordFilter=l)},null,8,["modelValue"])]),_:1}),d.enableSensitiveWordFilter?(w(),I(t,{key:0,label:"敏感词列表",prop:"sensitiveWords"},{default:s(()=>[a(r,{modelValue:d.sensitiveWords,"onUpdate:modelValue":e[13]||(e[13]=l=>d.sensitiveWords=l),type:"textarea",rows:5,placeholder:"敏感词之间用逗号分隔"},null,8,["modelValue"])]),_:1})):Q("",!0),a(t,null,{default:s(()=>[a(g,{type:"primary",onClick:G},{default:s(()=>e[20]||(e[20]=[k("保存设置")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["modelValue"])]),_:1})])}}},re=Y(ee,[["__scopeId","data-v-7ff055bd"]]);export{re as default};
