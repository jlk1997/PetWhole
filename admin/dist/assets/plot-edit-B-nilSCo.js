import{u as b,c as w,a as J}from"./story-C7UPQB8y.js";import{_ as y}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{b as q,e as l,w as r,g as a,s as d,D as S,o as c,J as x,i as O,p as f,d as _,t as E}from"./index-BZUGXbIj.js";import"./index-xsH4HHeE.js";const k={name:"PlotEdit",data(){return{isEdit:!1,plotId:null,loading:!1,requirementJson:"{}",rewardJson:"{}",plotForm:{title:"",description:"",coverImage:"",isMainStory:!1,isActive:!0,sortOrder:0,requirement:{},reward:{}},rules:{title:[{required:!0,message:"请输入剧情标题",trigger:"blur"},{min:2,max:50,message:"长度在 2 到 50 个字符",trigger:"blur"}],description:[{required:!0,message:"请输入剧情描述",trigger:"blur"}]}}},created(){const s=this.$route.params.id;this.isEdit=!!s,this.isEdit&&(this.plotId=s,this.fetchPlotData())},methods:{fetchPlotData(){this.loading=!0,J(this.plotId).then(s=>{const e=s.data.plot;this.plotForm={title:e.title,description:e.description,coverImage:e.coverImage||"",isMainStory:e.isMainStory,isActive:e.isActive,sortOrder:e.sortOrder||0,requirement:e.requirement||{},reward:e.reward||{}},this.requirementJson=JSON.stringify(e.requirement||{},null,2),this.rewardJson=JSON.stringify(e.reward||{},null,2),this.loading=!1}).catch(()=>{this.loading=!1,d.error("获取剧情信息失败")})},submitForm(){this.$refs.plotForm.validate(s=>{if(s){try{this.plotForm.requirement=JSON.parse(this.requirementJson||"{}"),this.plotForm.reward=JSON.parse(this.rewardJson||"{}")}catch{return d.error("JSON格式不正确")}this.loading=!0,(this.isEdit?b(this.plotId,this.plotForm):w(this.plotForm)).then(()=>{d.success(this.isEdit?"更新成功":"创建成功"),this.goBack()}).catch(()=>{d.error(this.isEdit?"更新失败":"创建失败")}).finally(()=>{this.loading=!1})}else return!1})},goBack(){this.$router.push("/story/plots")}}},I={class:"app-container"},N={class:"card-header"};function U(s,e,g,B,t,u){const n=a("el-input"),i=a("el-form-item"),m=a("el-switch"),h=a("el-input-number"),p=a("el-button"),v=a("el-form"),V=a("el-card"),F=S("loading");return c(),q("div",I,[l(V,{class:"box-card"},{header:r(()=>[_("div",N,[_("span",null,E(t.isEdit?"编辑剧情":"创建剧情"),1)])]),default:r(()=>[x((c(),O(v,{ref:"plotForm",model:t.plotForm,rules:t.rules,"label-width":"120px"},{default:r(()=>[l(i,{label:"剧情标题",prop:"title"},{default:r(()=>[l(n,{modelValue:t.plotForm.title,"onUpdate:modelValue":e[0]||(e[0]=o=>t.plotForm.title=o),placeholder:"请输入剧情标题"},null,8,["modelValue"])]),_:1}),l(i,{label:"剧情描述",prop:"description"},{default:r(()=>[l(n,{modelValue:t.plotForm.description,"onUpdate:modelValue":e[1]||(e[1]=o=>t.plotForm.description=o),type:"textarea",rows:4,placeholder:"请输入剧情描述"},null,8,["modelValue"])]),_:1}),l(i,{label:"封面图片"},{default:r(()=>[l(n,{modelValue:t.plotForm.coverImage,"onUpdate:modelValue":e[2]||(e[2]=o=>t.plotForm.coverImage=o),placeholder:"请输入封面图片URL"},null,8,["modelValue"])]),_:1}),l(i,{label:"是否主线剧情"},{default:r(()=>[l(m,{modelValue:t.plotForm.isMainStory,"onUpdate:modelValue":e[3]||(e[3]=o=>t.plotForm.isMainStory=o),"active-value":!0,"inactive-value":!1},null,8,["modelValue"])]),_:1}),l(i,{label:"是否激活"},{default:r(()=>[l(m,{modelValue:t.plotForm.isActive,"onUpdate:modelValue":e[4]||(e[4]=o=>t.plotForm.isActive=o),"active-value":!0,"inactive-value":!1},null,8,["modelValue"])]),_:1}),l(i,{label:"排序"},{default:r(()=>[l(h,{modelValue:t.plotForm.sortOrder,"onUpdate:modelValue":e[5]||(e[5]=o=>t.plotForm.sortOrder=o),min:0,max:999},null,8,["modelValue"])]),_:1}),l(i,{label:"剧情要求",title:"JSON格式的特殊要求配置"},{default:r(()=>[l(n,{modelValue:t.requirementJson,"onUpdate:modelValue":e[6]||(e[6]=o=>t.requirementJson=o),type:"textarea",rows:3,placeholder:"{}"},null,8,["modelValue"])]),_:1}),l(i,{label:"完成奖励",title:"JSON格式的奖励配置"},{default:r(()=>[l(n,{modelValue:t.rewardJson,"onUpdate:modelValue":e[7]||(e[7]=o=>t.rewardJson=o),type:"textarea",rows:3,placeholder:"{}"},null,8,["modelValue"])]),_:1}),l(i,null,{default:r(()=>[l(p,{type:"primary",onClick:u.submitForm},{default:r(()=>e[8]||(e[8]=[f("保存")])),_:1},8,["onClick"]),l(p,{onClick:u.goBack},{default:r(()=>e[9]||(e[9]=[f("取消")])),_:1},8,["onClick"])]),_:1})]),_:1},8,["model","rules"])),[[F,t.loading]])]),_:1})])}const A=y(k,[["render",U],["__scopeId","data-v-983896ab"]]);export{A as default};
