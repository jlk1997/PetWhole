import{i as S,e as L,d as E,g as I}from"./story-C7UPQB8y.js";import{_ as B}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{b,d as g,J as O,e as o,w as t,g as s,D as N,i as c,s as u,E as U,o as m,p as a,t as w}from"./index-BZUGXbIj.js";import"./index-xsH4HHeE.js";const J={name:"StoryPlots",data(){return{plots:[],listLoading:!0,importDialogVisible:!1,importConfig:""}},created(){this.fetchData()},methods:{fetchData(){this.listLoading=!0,I().then(i=>{this.plots=i.data,this.listLoading=!1}).catch(()=>{this.listLoading=!1})},formatDate(i){return i?new Date(i).toLocaleString():""},handleCreatePlot(){this.$router.push("/story/plots/create")},handleViewPlot(i){this.$router.push(`/story/plots/${i._id}`)},handleEditPlot(i){this.$router.push(`/story/plots/${i._id}/edit`)},handleDeletePlot(i){U.confirm("此操作将永久删除该剧情及其所有章节和事件，是否继续？","确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{E(i._id).then(()=>{u({type:"success",message:"删除成功!"}),this.fetchData()})}).catch(()=>{u({type:"info",message:"已取消删除"})})},handleExportPlot(i){L(i._id).then(e=>{const y=e.data,h=new Blob([JSON.stringify(y,null,2)],{type:"application/json"}),n=document.createElement("a");n.href=URL.createObjectURL(h),n.download=`剧情配置_${i.title}_${new Date().toISOString().split("T")[0]}.json`,n.click(),URL.revokeObjectURL(n.href),u({type:"success",message:"导出成功!"})})},handleImportPlot(){this.importDialogVisible=!0,this.importConfig=""},submitImport(){try{const i=JSON.parse(this.importConfig);S({storyConfig:i}).then(()=>{u({type:"success",message:"导入成功!"}),this.importDialogVisible=!1,this.fetchData()}).catch(e=>{u({type:"error",message:`导入失败: ${e.message}`})})}catch{u({type:"error",message:"无效的JSON格式"})}}}},j={class:"app-container"},z={class:"filter-container"},R=["src"],T={class:"dialog-footer"};function M(i,e,y,h,n,r){const d=s("el-button"),p=s("el-table-column"),k=s("el-icon"),f=s("el-tag"),C=s("el-table"),D=s("el-input"),v=s("el-form-item"),V=s("el-form"),P=s("el-dialog"),x=N("loading");return m(),b("div",j,[g("div",z,[o(d,{class:"filter-item",type:"primary",icon:"el-icon-plus",onClick:r.handleCreatePlot},{default:t(()=>e[3]||(e[3]=[a(" 创建剧情 ")])),_:1},8,["onClick"]),o(d,{class:"filter-item",type:"primary",icon:"el-icon-upload2",onClick:r.handleImportPlot},{default:t(()=>e[4]||(e[4]=[a(" 导入剧情 ")])),_:1},8,["onClick"])]),O((m(),c(C,{data:n.plots,"element-loading-text":"加载中...",border:"",fit:"","highlight-current-row":""},{default:t(()=>[o(p,{align:"center",label:"ID",width:"80"},{default:t(l=>[g("span",null,w(l.$index+1),1)]),_:1}),o(p,{width:"120",align:"center",label:"封面"},{default:t(l=>[l.row.coverImage?(m(),b("img",{key:0,src:l.row.coverImage,class:"cover-image"},null,8,R)):(m(),c(k,{key:1,class:"el-icon-picture-outline"}))]),_:1}),o(p,{align:"center",label:"标题",prop:"title"}),o(p,{align:"center",label:"类型",width:"120"},{default:t(l=>[l.row.isMainStory?(m(),c(f,{key:0,type:"danger"},{default:t(()=>e[5]||(e[5]=[a("主线剧情")])),_:1})):(m(),c(f,{key:1},{default:t(()=>e[6]||(e[6]=[a("支线剧情")])),_:1}))]),_:1}),o(p,{align:"center",label:"状态",width:"120"},{default:t(l=>[l.row.isActive?(m(),c(f,{key:0,type:"success"},{default:t(()=>e[7]||(e[7]=[a("已激活")])),_:1})):(m(),c(f,{key:1,type:"info"},{default:t(()=>e[8]||(e[8]=[a("未激活")])),_:1}))]),_:1}),o(p,{align:"center",label:"排序",width:"80",prop:"sortOrder"}),o(p,{align:"center",label:"创建时间",width:"180"},{default:t(l=>[g("span",null,w(r.formatDate(l.row.createdAt)),1)]),_:1}),o(p,{align:"center",label:"操作",width:"300"},{default:t(l=>[o(d,{size:"small",type:"primary",onClick:_=>r.handleViewPlot(l.row)},{default:t(()=>e[9]||(e[9]=[a(" 查看 ")])),_:2},1032,["onClick"]),o(d,{size:"small",type:"success",onClick:_=>r.handleEditPlot(l.row)},{default:t(()=>e[10]||(e[10]=[a(" 编辑 ")])),_:2},1032,["onClick"]),o(d,{size:"small",type:"warning",onClick:_=>r.handleExportPlot(l.row)},{default:t(()=>e[11]||(e[11]=[a(" 导出 ")])),_:2},1032,["onClick"]),o(d,{size:"small",type:"danger",onClick:_=>r.handleDeletePlot(l.row)},{default:t(()=>e[12]||(e[12]=[a(" 删除 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[x,n.listLoading]]),o(P,{title:"导入剧情配置",modelValue:n.importDialogVisible,"onUpdate:modelValue":e[2]||(e[2]=l=>n.importDialogVisible=l),width:"50%"},{footer:t(()=>[g("span",T,[o(d,{onClick:e[1]||(e[1]=l=>n.importDialogVisible=!1)},{default:t(()=>e[13]||(e[13]=[a("取消")])),_:1}),o(d,{type:"primary",onClick:r.submitImport},{default:t(()=>e[14]||(e[14]=[a("确认导入")])),_:1},8,["onClick"])])]),default:t(()=>[o(V,null,{default:t(()=>[o(v,{label:"配置文件"},{default:t(()=>[o(D,{type:"textarea",modelValue:n.importConfig,"onUpdate:modelValue":e[0]||(e[0]=l=>n.importConfig=l),rows:10,placeholder:"请粘贴剧情配置JSON数据"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}const G=B(J,[["render",M],["__scopeId","data-v-39c5527d"]]);export{G as default};
